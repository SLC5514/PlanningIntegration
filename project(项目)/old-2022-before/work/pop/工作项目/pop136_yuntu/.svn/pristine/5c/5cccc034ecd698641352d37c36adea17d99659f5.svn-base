/*
 * @Author: SLC
 * @Date: 2020-04-26 13:04:11
 * @LastEditors: SLC
 * @LastEditTime: 2020-05-18 13:15:53
 * @Description: 2D实景模拟
 */

require.config({
    paths: {
        "virtualSnap": ["virtual/virtual-snap"],
        "perfect-scrollbar": ["lib/perfect-scrollbar"],
        "mousewheel": ["lib/jquery.mousewheel"],
        "Snap": ["lib/snap.svg-min"],
    },
    shim: {
        "virtualSnap": {
            deps: ["jquery", "Snap"],
            exports: "virtualSnap"
        },
        "perfect-scrollbar": {
            deps: ["jquery", "mousewheel"]
        },
    }
});
var pattern_model = null;
require(["jquery", "general", "msg", "virtualSnap", "Snap", "mousewheel", "perfect-scrollbar"], function (jquery, general, msg, virtualSnap, Snap) {
    $(function () {
        // 拾色器初始项
        var colorPickerBox = $('.js-color-picker');
        var colorRibbonCvs = colorPickerBox.find('.color-ribbon')[0];
        var colorSwatchCvs = colorPickerBox.find('.color-swatch')[0];
        var swatchVal = colorPickerBox.find('.swatch-val input');
        colorRibbonCvs.width = $(colorRibbonCvs).width();
        colorRibbonCvs.height = $(colorRibbonCvs).height();
        colorSwatchCvs.width = $(colorSwatchCvs).width();
        colorSwatchCvs.height = $(colorSwatchCvs).height();

        // 全局初始项
        var def = {
            loadingEl: $('.js-loading-div'),
            loadingBgEl: $('.js-bg-div'),

            // asideNavSEl: $(".js-aside-nav-Sb"), // 所有侧栏导航滚动条盒子
            // asideControlSEl: $(".js-aside-control-Sb"), // 侧栏控制器滚动条盒子

            // 拾色器初始项
            colorPickerBox: colorPickerBox,
            colorRibbonCvs: colorRibbonCvs,
            colorRibbonCtx: colorRibbonCvs.getContext("2d"),
            colorSwatchCvs: colorSwatchCvs,
            colorSwatchCtx: colorSwatchCvs.getContext("2d"),
            swatchVal: swatchVal, // 回显输入框（rgb，16进制）
            colorSwatchX: colorSwatchCvs.width - 1, // 默认取色点x位置
            colorSwatchY: 0, // 默认取色点y位置
            isDragStart: false, // 是否开始拖拽

            // 侧栏导航(1:服装, 2:箱包, 3:鞋子, 5:家纺, 100:其他)
            asideNavData: {
                "1": {
                    "name": "服装",
                    "data": {
                        "classify": [
                            "102",
                            "103"
                        ],
                        "list": {
                            "count": 2,
                            "pageSize": 20,
                            "list": [
                                {
                                    "id": "1",
                                    "iSiteId": "1",
                                    "iClassifyId": "103",
                                    "sTemplateName": "通用模板测试",
                                    "iIsCustom": "0",
                                    "iUserId": "0",
                                    "sCover": "/upload/yuntu/virtual/images/202005/yuntu_virtual_5eba6b3284055.png",
                                    "sBigTemplateImg": "/upload/yuntu/virtual/images/202005/yuntu_virtual_5eba6b365d581.png",
                                    "iPublishStatus": "1",
                                    "iStatus": "1",
                                    "dCreateTime": "2020-05-12 18:05:11",
                                    "dUpdateTime": "2020-05-13 17:14:04",
                                    "svg_file": [
                                        {
                                            "iTemplateId": "1",
                                            "sPartName": "大身-01-01",
                                            "sPartPath": ['M300,984.67c1.67-6.67,10.67-33,10.67-36.33s3-17.33,3-17.33S319,896,320,888s10.67-38.33,10.67-38.33S332,811,332.33,807.33,339,766.67,339,766.67s-2.67-18.67-4-23-4.33-46.33-4-47.33-3.33-52.67-3.33-52.67-2.67-61.67-4-74.33-6-45.67-7.67-53a26.49,26.49,0,0,1,0-12.67S313,493,311.67,487s-6.33-28.33-6.33-28.33S288.67,435,281,429.33c-4.43-3.28-6.86-11.12-8.12-17.15a7.73,7.73,0,0,0-.41.81,12.82,12.82,0,0,0-.91,3.85l-.9,1.88c-6.78,11-9.35,23.38-11.1,36-.54,1.19-5.82,27.26-6.93,39.27-1.25,13.47-2.49,26.95-4.15,40.37-1.87,15.08-3.33,30.17-3.8,45.36,0,1.32-1,5.65-1,6.66,0,8.44-1.63,16.81-1.08,25.28-2.29,6-.85,12.33-1.67,18.52-2.59,19.44-4.13,39-6.08,58.53-1,4.56-1,9.22-1.39,13.83-1.1,11.85-2.44,23.67-3.81,35.49-1.43,12.31-3,24.61-4.51,36.9q-2.16,17.21-4.43,34.41-2.45,18.67-5,37.34c-4.22,25.54-3.23,51.42-5,77.12q0,.92,0,1.85t0,2.11c0,5,.23,10-.11,15-1.13,16.69,4.2,33,3.12,49.63-.31,4.83.89,9.54,2,14.22a50.66,50.66,0,0,0,2.91,19.14l3,18a27.64,27.64,0,0,1-.36,3.46c-1.85,8-3,16,1.8,23.58a8.18,8.18,0,0,1,1,4.81s1.21-5.56,16.21-8.56,32.84-6.32,42.34-4.07c7,1.65,6.91,1.82,6.91,1.82s-.5-8,.75-11.75a53.85,53.85,0,0,1,2.5-6.27s.58-17.4.58-24.06S298.33,991.33,300,984.67Z","M729.5,1018.33s-3.83-27.67-4.62-36.33-2.54-14.67-3.54-20-4.67-28-6.67-35.67S712.33,902,711.33,892s-7-32.33-8.67-37.67-4-24.33-4-24.33-.33-23-2-30S695,776.33,695,776.33l2-30,4-42,3.67-39,2.67-37,3.33-41s.33-26.33,2-31,6.33-21,8.67-26.67,0-8.33,0-10.67,7-27,7-27a76.91,76.91,0,0,0,0-9c-.33-2.33,4-34,4-34,9.1-5.26,18.81-25.1,25-39.9-.71-2.07-2.38-3.46-3.93-4.85a209.13,209.13,0,0,0-24.77-19.62c-.15-1.48-1-2-2.39-1.69l-1.6-.37c-.24-1.22-.53-2.33-2-1a7.47,7.47,0,0,1-4.09-1.77c.07-2-1.46-2.53-2.87-2.93-8-2.26-15.67-5.16-23.4-8.09q-25.77-9.76-51.75-18.95c-13.13-4.64-26-9.91-38.87-15.2a65.62,65.62,0,0,1-5.08-10.17c-3.18-8.51-6.69-17.9-10.26-26.25-.76-1.78-5.22-6.39-8.25-6.25,3.75,14.88,2.54,21.17,1.35,23.64-.59.71-1.39,2.39-2,3.11-6.33,10.67-13.69,18-22.64,25.61-10.94,9.3-22.5,17.88-33.81,26.75-1.5,1.18-.35,2.76-.05,4.89.07-1.51-5.5-.24-7.06-1.37-16.37-11.92-34-22.17-49-35.84-5.46-5-21-26-21-26.9-2-2.37.13-3.19,1.25-7.37,1.12-3.48,4-9.33,4.13-11.37-9.75,1.75-11.76,8.84-12.5,10.9-2.13,5.91-3.7,12-6.11,17.83-1.94,4.65-2.4,10-5.86,14-8.05,3.47-16.12,6.89-24.15,10.4-28.69,12.55-58.55,22.1-87.27,34.6C301.37,386,290,392,281.2,401.76c-2.36,2.61-6.06,3.89-6.08,8a10.31,10.31,0,0,0-2.24,2.42c1.26,6,3.68,13.88,8.12,17.15,7.67,5.67,24.33,29.33,24.33,29.33s5,22.33,6.33,28.33S316,503.67,316,503.67a26.49,26.49,0,0,0,0,12.67c1.67,7.33,6.33,40.33,7.67,53s4,74.33,4,74.33,3.67,51.67,3.33,52.67,2.67,43,4,47.33,4,23,4,23-6.33,37-6.67,40.67-1.67,42.33-1.67,42.33S321,880,320,888s-6.33,43-6.33,43-3,14-3,17.33-9,29.67-10.67,36.33-6.67,31.33-6.67,38-.58,24.06-.58,24.06c2.83-1.37,2.93,1.2,3.62,2.64,5.3,11.07,10.52,22.18,15.77,33.27.72,1.53,18.5,32,38,41.75,9.2,4.63,19.38,6.53,29.63,8,15.88,2.28,32.11,1.05,48,1.75,13.38.59,26.5-.37,40.22-.47,10.78-.08,21.52-1.32,32.28-2,1.89-.12,3.6-.66,4.61-2.47l1.41.29c22.09,2,44.22,3.3,66.38,4.21,1,.44,51.16,4.32,65.6,2.09,9.63-1.49,18.58-1.35,28.23-2.66,22.76-3.08,36.45-19,48.56-36.43,3.76-5.42,6.32-11.66,9.45-17.52.52-1,5.37-14.15,6.88-13.52l.63-5.88.67-.11-3.17-22.31Z","M814.53,878.11c-.78-8.74-1.35-17.49-2.09-26.23-1.09-12.85-2.56-25.66-3.76-38.5-.81-8.73-1.36-17.49-2.16-26.23-1.23-13.5-2.58-27-3.88-40.49-.74-7.74-1.44-15.48-2.25-23.22-1.2-11.5-2.55-23-3.73-34.5-1.13-11-2-22.08-3.21-33.09-1.46-13.14-3.35-26.23-4.74-39.37-1.27-12-1.93-24.08-3.18-36.09-2-19.62-4-39.23-3.93-59,0-1.91.73-4-.94-5.7,0-9.91,1-20-1.27-29.67-3.81-16.19-5.61-32.76-9.69-48.88-.31-1.21-2-5.1-2.1-6.39a3.06,3.06,0,0,0-.51.08,3.06,3.06,0,0,1,.51-.08c-2.63-7.37-6.56-14.13-10-21.1,0-.2-.12-.39-.18-.58-6.23,14.81-15.94,34.65-25,39.9,0,0-4.33,31.67-4,34a76.91,76.91,0,0,1,0,9s-7,24.67-7,27,2.33,5,0,10.67-7,22-8.67,26.67-2,31-2,31l-3.33,41-2.67,37-3.67,39-4,42-2,30S695,793,696.67,800s2,30,2,30,2.33,19,4,24.33S710.33,882,711.33,892s1.33,26.67,3.33,34.33,5.67,30.33,6.67,35.67,2.75,11.33,3.54,20,4.63,36.33,4.63,36.33v19l3.17,22.31c4.45-.7,30.57-4.59,46.08-1.39,17,3.5,18.75,5.25,18.75,5.25l1.09-6.71a164.83,164.83,0,0,0,10-41,160.94,160.94,0,0,0,2.21-17.21c.47-8.75,1.13-17.53,2.14-26.22,1.63-14,2.45-28,3.55-42C817.85,912.91,816.09,895.47,814.53,878.11Z']
                                        },
                                        {
                                            "iTemplateId": "1",
                                            "sPartName": "领子-01-01",
                                            "sPartPath": ['M513.51,374.63c-16.37-11.92-34-22.17-49-35.84-5.46-5-21-26-21-26.9-2-2.37.13-3.19,1.25-7.37,1.12-3.48,4-9.33,4.13-11.37-9.75,1.75-11.76,8.84-12.5,10.9-2.13,5.91-3.7,12-6.11,17.83-1.94,4.65-2.4,10-5.86,14a32.35,32.35,0,0,0,0,18.68c3.15,9.5,12.15,25.5,17.4,31.75s27.5,42.25,27.5,42.25.75,2.25,3.5-1.75,41-50,41-50Z","M521,376s34.25,47.5,36.25,50.5,3.46,2.63,3.46,2.63,3.54-6.88,4.79-10.38S581.75,390,586,383.5s12-18.25,15.71-27.5,0-21.33,0-21.33L596.2,324.5c-3.18-8.51-6.69-17.9-10.26-26.25-.76-1.78-5.22-6.39-8.25-6.25,3.75,14.88,2.54,21.17,1.35,23.64-.59.71-1.39,2.39-2,3.11-6.33,10.67-13.69,18-22.64,25.61-10.94,9.3-22.5,17.88-33.81,26.75-1.5,1.18-1.49,1.91.38,4.89Z']
                                        },
                                        {
                                            "iTemplateId": "1",
                                            "sPartName": "袖口",
                                            "sPartPath": ['M289.85,1065.16c-16.87-6.76-65.87,1.59-65.31,10.81.12,1.93.14-1.58,0,0-1.66,18.7,1.08,37.43-.34,56.13.49,4-.84,8.81.67,12.82,2.25,3.63,6.93,5.69,10.13,5,2,.13-.68-9.24,3.62-9.81,2.44-.55,37-4.92,45.49-5l11.1-.16s2.6.08,3.93,0c.91.05,3.3,1.17,4.2,1.23a9,9,0,0,0,.17-2.83c-3.77-16.47-6.07-33.74-10.17-50.17Z","M783,1059s1.53.36-8.47-1.64-42.53,2.39-42.53,2.39l-.62,5.88-3.06,27.54-.33,2.55c-.63-.18-.22,6.11-.24,6.52-.29,9-.25,19-2.87,31,0,0,32.63-1.62,43.25-.75s15.8,2.4,15.8,2.4l11.94,2.31.77.53a1.79,1.79,0,0,0,1.11-2c-.26-11.77.55-23.5,1-35.25.49-14.22-1.21-22.75-1.21-37Z']
                                        },
                                        {
                                            "iTemplateId": "1",
                                            "sPartName": "袖子-01-01",
                                            "sPartPath": ['M300,984.67c1.67-6.67,10.67-33,10.67-36.33s3-17.33,3-17.33S319,896,320,888s10.67-38.33,10.67-38.33S332,811,332.33,807.33,339,766.67,339,766.67s-2.67-18.67-4-23-4.33-46.33-4-47.33-3.33-52.67-3.33-52.67-2.67-61.67-4-74.33-6-45.67-7.67-53a26.49,26.49,0,0,1,0-12.67S313,493,311.67,487s-6.33-28.33-6.33-28.33S288.67,435,281,429.33c-4.43-3.28-6.86-11.12-8.12-17.15a7.73,7.73,0,0,0-.41.81,12.82,12.82,0,0,0-.91,3.85l-.9,1.88c-6.78,11-9.35,23.38-11.1,36-.54,1.19-5.82,27.26-6.93,39.27-1.25,13.47-2.49,26.95-4.15,40.37-1.87,15.08-3.33,30.17-3.8,45.36,0,1.32-1,5.65-1,6.66,0,8.44-1.63,16.81-1.08,25.28-2.29,6-.85,12.33-1.67,18.52-2.59,19.44-4.13,39-6.08,58.53-1,4.56-1,9.22-1.39,13.83-1.1,11.85-2.44,23.67-3.81,35.49-1.43,12.31-3,24.61-4.51,36.9q-2.16,17.21-4.43,34.41-2.45,18.67-5,37.34c-4.22,25.54-3.23,51.42-5,77.12q0,.92,0,1.85t0,2.11c0,5,.23,10-.11,15-1.13,16.69,4.2,33,3.12,49.63-.31,4.83.89,9.54,2,14.22a50.66,50.66,0,0,0,2.91,19.14l3,18a27.64,27.64,0,0,1-.36,3.46c-1.85,8-3,16,1.8,23.58a8.18,8.18,0,0,1,1,4.81s1.21-5.56,16.21-8.56,32.84-6.32,42.34-4.07c7,1.65,6.91,1.82,6.91,1.82s-.5-8,.75-11.75a53.85,53.85,0,0,1,2.5-6.27s.58-17.4.58-24.06S298.33,991.33,300,984.67Z","M814.53,878.11c-.78-8.74-1.35-17.49-2.09-26.23-1.09-12.85-2.56-25.66-3.76-38.5-.81-8.73-1.36-17.49-2.16-26.23-1.23-13.5-2.58-27-3.88-40.49-.74-7.74-1.44-15.48-2.25-23.22-1.2-11.5-2.55-23-3.73-34.5-1.13-11-2-22.08-3.21-33.09-1.46-13.14-3.35-26.23-4.74-39.37-1.27-12-1.93-24.08-3.18-36.09-2-19.62-4-39.23-3.93-59,0-1.91.73-4-.94-5.7,0-9.91,1-20-1.27-29.67-3.81-16.19-5.61-32.76-9.69-48.88-.31-1.21-2-5.1-2.1-6.39a3.06,3.06,0,0,0-.51.08,3.06,3.06,0,0,1,.51-.08c-2.63-7.37-6.56-14.13-10-21.1,0-.2-.12-.39-.18-.58-6.23,14.81-15.94,34.65-25,39.9,0,0-4.33,31.67-4,34a76.91,76.91,0,0,1,0,9s-7,24.67-7,27,2.33,5,0,10.67-7,22-8.67,26.67-2,31-2,31l-3.33,41-2.67,37-3.67,39-4,42-2,30S695,793,696.67,800s2,30,2,30,2.33,19,4,24.33S710.33,882,711.33,892s1.33,26.67,3.33,34.33,5.67,30.33,6.67,35.67,2.75,11.33,3.54,20,4.63,36.33,4.63,36.33v19l3.17,22.31c4.45-.7,30.57-4.59,46.08-1.39,17,3.5,18.75,5.25,18.75,5.25l1.09-6.71a164.83,164.83,0,0,0,10-41,160.94,160.94,0,0,0,2.21-17.21c.47-8.75,1.13-17.53,2.14-26.22,1.63-14,2.45-28,3.55-42C817.85,912.91,816.09,895.47,814.53,878.11Z']
                                        }
                                    ]
                                },
                                {
                                    "id": "3",
                                    "iSiteId": "1",
                                    "iClassifyId": "102",
                                    "sTemplateName": "通用模板测试",
                                    "iIsCustom": "0",
                                    "iUserId": "0",
                                    "sCover": "/upload/yuntu/virtual/images/202005/yuntu_virtual_5eba6b3284055.png",
                                    "sBigTemplateImg": "/upload/yuntu/virtual/images/202005/yuntu_virtual_5eba6b365d581.png",
                                    "iPublishStatus": "1",
                                    "iStatus": "1",
                                    "dCreateTime": "2020-05-12 18:05:11",
                                    "dUpdateTime": "2020-05-13 17:14:11",
                                    "svg_file": [

                                    ]
                                }
                            ]
                        }
                    }
                },
                "2": {
                    "name": "箱包",
                    "data": {
                        "classify": [
                            "104",
                            "105"
                        ],
                        "list": {
                            "count": 1,
                            "pageSize": 20,
                            "list": [
                                {
                                    "id": "4",
                                    "iSiteId": "2",
                                    "iClassifyId": "104",
                                    "sTemplateName": "箱包模板1",
                                    "iIsCustom": "0",
                                    "iUserId": "0",
                                    "sCover": "/upload/yuntu/virtual/images/202005/yuntu_virtual_5ebbc95596410.png",
                                    "sBigTemplateImg": "/upload/yuntu/virtual/images/202005/yuntu_virtual_5ebbc965b69cf.png",
                                    "iPublishStatus": "1",
                                    "iStatus": "1",
                                    "dCreateTime": "2020-05-13 18:18:24",
                                    "dUpdateTime": "2020-05-13 19:00:02",
                                    "svg_file": [
                                        {
                                            "iTemplateId": "4",
                                            "sPartName": "大身-01-01",
                                            "sPartPath": ['M300,984.67c1.67-6.67,10.67-33,10.67-36.33s3-17.33,3-17.33S319,896,320,888s10.67-38.33,10.67-38.33S332,811,332.33,807.33,339,766.67,339,766.67s-2.67-18.67-4-23-4.33-46.33-4-47.33-3.33-52.67-3.33-52.67-2.67-61.67-4-74.33-6-45.67-7.67-53a26.49,26.49,0,0,1,0-12.67S313,493,311.67,487s-6.33-28.33-6.33-28.33S288.67,435,281,429.33c-4.43-3.28-6.86-11.12-8.12-17.15a7.73,7.73,0,0,0-.41.81,12.82,12.82,0,0,0-.91,3.85l-.9,1.88c-6.78,11-9.35,23.38-11.1,36-.54,1.19-5.82,27.26-6.93,39.27-1.25,13.47-2.49,26.95-4.15,40.37-1.87,15.08-3.33,30.17-3.8,45.36,0,1.32-1,5.65-1,6.66,0,8.44-1.63,16.81-1.08,25.28-2.29,6-.85,12.33-1.67,18.52-2.59,19.44-4.13,39-6.08,58.53-1,4.56-1,9.22-1.39,13.83-1.1,11.85-2.44,23.67-3.81,35.49-1.43,12.31-3,24.61-4.51,36.9q-2.16,17.21-4.43,34.41-2.45,18.67-5,37.34c-4.22,25.54-3.23,51.42-5,77.12q0,.92,0,1.85t0,2.11c0,5,.23,10-.11,15-1.13,16.69,4.2,33,3.12,49.63-.31,4.83.89,9.54,2,14.22a50.66,50.66,0,0,0,2.91,19.14l3,18a27.64,27.64,0,0,1-.36,3.46c-1.85,8-3,16,1.8,23.58a8.18,8.18,0,0,1,1,4.81s1.21-5.56,16.21-8.56,32.84-6.32,42.34-4.07c7,1.65,6.91,1.82,6.91,1.82s-.5-8,.75-11.75a53.85,53.85,0,0,1,2.5-6.27s.58-17.4.58-24.06S298.33,991.33,300,984.67Z","M729.5,1018.33s-3.83-27.67-4.62-36.33-2.54-14.67-3.54-20-4.67-28-6.67-35.67S712.33,902,711.33,892s-7-32.33-8.67-37.67-4-24.33-4-24.33-.33-23-2-30S695,776.33,695,776.33l2-30,4-42,3.67-39,2.67-37,3.33-41s.33-26.33,2-31,6.33-21,8.67-26.67,0-8.33,0-10.67,7-27,7-27a76.91,76.91,0,0,0,0-9c-.33-2.33,4-34,4-34,9.1-5.26,18.81-25.1,25-39.9-.71-2.07-2.38-3.46-3.93-4.85a209.13,209.13,0,0,0-24.77-19.62c-.15-1.48-1-2-2.39-1.69l-1.6-.37c-.24-1.22-.53-2.33-2-1a7.47,7.47,0,0,1-4.09-1.77c.07-2-1.46-2.53-2.87-2.93-8-2.26-15.67-5.16-23.4-8.09q-25.77-9.76-51.75-18.95c-13.13-4.64-26-9.91-38.87-15.2a65.62,65.62,0,0,1-5.08-10.17c-3.18-8.51-6.69-17.9-10.26-26.25-.76-1.78-5.22-6.39-8.25-6.25,3.75,14.88,2.54,21.17,1.35,23.64-.59.71-1.39,2.39-2,3.11-6.33,10.67-13.69,18-22.64,25.61-10.94,9.3-22.5,17.88-33.81,26.75-1.5,1.18-.35,2.76-.05,4.89.07-1.51-5.5-.24-7.06-1.37-16.37-11.92-34-22.17-49-35.84-5.46-5-21-26-21-26.9-2-2.37.13-3.19,1.25-7.37,1.12-3.48,4-9.33,4.13-11.37-9.75,1.75-11.76,8.84-12.5,10.9-2.13,5.91-3.7,12-6.11,17.83-1.94,4.65-2.4,10-5.86,14-8.05,3.47-16.12,6.89-24.15,10.4-28.69,12.55-58.55,22.1-87.27,34.6C301.37,386,290,392,281.2,401.76c-2.36,2.61-6.06,3.89-6.08,8a10.31,10.31,0,0,0-2.24,2.42c1.26,6,3.68,13.88,8.12,17.15,7.67,5.67,24.33,29.33,24.33,29.33s5,22.33,6.33,28.33S316,503.67,316,503.67a26.49,26.49,0,0,0,0,12.67c1.67,7.33,6.33,40.33,7.67,53s4,74.33,4,74.33,3.67,51.67,3.33,52.67,2.67,43,4,47.33,4,23,4,23-6.33,37-6.67,40.67-1.67,42.33-1.67,42.33S321,880,320,888s-6.33,43-6.33,43-3,14-3,17.33-9,29.67-10.67,36.33-6.67,31.33-6.67,38-.58,24.06-.58,24.06c2.83-1.37,2.93,1.2,3.62,2.64,5.3,11.07,10.52,22.18,15.77,33.27.72,1.53,18.5,32,38,41.75,9.2,4.63,19.38,6.53,29.63,8,15.88,2.28,32.11,1.05,48,1.75,13.38.59,26.5-.37,40.22-.47,10.78-.08,21.52-1.32,32.28-2,1.89-.12,3.6-.66,4.61-2.47l1.41.29c22.09,2,44.22,3.3,66.38,4.21,1,.44,51.16,4.32,65.6,2.09,9.63-1.49,18.58-1.35,28.23-2.66,22.76-3.08,36.45-19,48.56-36.43,3.76-5.42,6.32-11.66,9.45-17.52.52-1,5.37-14.15,6.88-13.52l.63-5.88.67-.11-3.17-22.31Z","M814.53,878.11c-.78-8.74-1.35-17.49-2.09-26.23-1.09-12.85-2.56-25.66-3.76-38.5-.81-8.73-1.36-17.49-2.16-26.23-1.23-13.5-2.58-27-3.88-40.49-.74-7.74-1.44-15.48-2.25-23.22-1.2-11.5-2.55-23-3.73-34.5-1.13-11-2-22.08-3.21-33.09-1.46-13.14-3.35-26.23-4.74-39.37-1.27-12-1.93-24.08-3.18-36.09-2-19.62-4-39.23-3.93-59,0-1.91.73-4-.94-5.7,0-9.91,1-20-1.27-29.67-3.81-16.19-5.61-32.76-9.69-48.88-.31-1.21-2-5.1-2.1-6.39a3.06,3.06,0,0,0-.51.08,3.06,3.06,0,0,1,.51-.08c-2.63-7.37-6.56-14.13-10-21.1,0-.2-.12-.39-.18-.58-6.23,14.81-15.94,34.65-25,39.9,0,0-4.33,31.67-4,34a76.91,76.91,0,0,1,0,9s-7,24.67-7,27,2.33,5,0,10.67-7,22-8.67,26.67-2,31-2,31l-3.33,41-2.67,37-3.67,39-4,42-2,30S695,793,696.67,800s2,30,2,30,2.33,19,4,24.33S710.33,882,711.33,892s1.33,26.67,3.33,34.33,5.67,30.33,6.67,35.67,2.75,11.33,3.54,20,4.63,36.33,4.63,36.33v19l3.17,22.31c4.45-.7,30.57-4.59,46.08-1.39,17,3.5,18.75,5.25,18.75,5.25l1.09-6.71a164.83,164.83,0,0,0,10-41,160.94,160.94,0,0,0,2.21-17.21c.47-8.75,1.13-17.53,2.14-26.22,1.63-14,2.45-28,3.55-42C817.85,912.91,816.09,895.47,814.53,878.11Z']
                                        },
                                        {
                                            "iTemplateId": "4",
                                            "sPartName": "袖口",
                                            "sPartPath": ['M289.85,1065.16c-16.87-6.76-65.87,1.59-65.31,10.81.12,1.93.14-1.58,0,0-1.66,18.7,1.08,37.43-.34,56.13.49,4-.84,8.81.67,12.82,2.25,3.63,6.93,5.69,10.13,5,2,.13-.68-9.24,3.62-9.81,2.44-.55,37-4.92,45.49-5l11.1-.16s2.6.08,3.93,0c.91.05,3.3,1.17,4.2,1.23a9,9,0,0,0,.17-2.83c-3.77-16.47-6.07-33.74-10.17-50.17Z","M783,1059s1.53.36-8.47-1.64-42.53,2.39-42.53,2.39l-.62,5.88-3.06,27.54-.33,2.55c-.63-.18-.22,6.11-.24,6.52-.29,9-.25,19-2.87,31,0,0,32.63-1.62,43.25-.75s15.8,2.4,15.8,2.4l11.94,2.31.77.53a1.79,1.79,0,0,0,1.11-2c-.26-11.77.55-23.5,1-35.25.49-14.22-1.21-22.75-1.21-37Z']
                                        },
                                        {
                                            "iTemplateId": "4",
                                            "sPartName": "领子-01-01",
                                            "sPartPath": ['M513.51,374.63c-16.37-11.92-34-22.17-49-35.84-5.46-5-21-26-21-26.9-2-2.37.13-3.19,1.25-7.37,1.12-3.48,4-9.33,4.13-11.37-9.75,1.75-11.76,8.84-12.5,10.9-2.13,5.91-3.7,12-6.11,17.83-1.94,4.65-2.4,10-5.86,14a32.35,32.35,0,0,0,0,18.68c3.15,9.5,12.15,25.5,17.4,31.75s27.5,42.25,27.5,42.25.75,2.25,3.5-1.75,41-50,41-50Z","M521,376s34.25,47.5,36.25,50.5,3.46,2.63,3.46,2.63,3.54-6.88,4.79-10.38S581.75,390,586,383.5s12-18.25,15.71-27.5,0-21.33,0-21.33L596.2,324.5c-3.18-8.51-6.69-17.9-10.26-26.25-.76-1.78-5.22-6.39-8.25-6.25,3.75,14.88,2.54,21.17,1.35,23.64-.59.71-1.39,2.39-2,3.11-6.33,10.67-13.69,18-22.64,25.61-10.94,9.3-22.5,17.88-33.81,26.75-1.5,1.18-1.49,1.91.38,4.89Z']
                                        },
                                        {
                                            "iTemplateId": "4",
                                            "sPartName": "袖子-01-01",
                                            "sPartPath": ['M300,984.67c1.67-6.67,10.67-33,10.67-36.33s3-17.33,3-17.33S319,896,320,888s10.67-38.33,10.67-38.33S332,811,332.33,807.33,339,766.67,339,766.67s-2.67-18.67-4-23-4.33-46.33-4-47.33-3.33-52.67-3.33-52.67-2.67-61.67-4-74.33-6-45.67-7.67-53a26.49,26.49,0,0,1,0-12.67S313,493,311.67,487s-6.33-28.33-6.33-28.33S288.67,435,281,429.33c-4.43-3.28-6.86-11.12-8.12-17.15a7.73,7.73,0,0,0-.41.81,12.82,12.82,0,0,0-.91,3.85l-.9,1.88c-6.78,11-9.35,23.38-11.1,36-.54,1.19-5.82,27.26-6.93,39.27-1.25,13.47-2.49,26.95-4.15,40.37-1.87,15.08-3.33,30.17-3.8,45.36,0,1.32-1,5.65-1,6.66,0,8.44-1.63,16.81-1.08,25.28-2.29,6-.85,12.33-1.67,18.52-2.59,19.44-4.13,39-6.08,58.53-1,4.56-1,9.22-1.39,13.83-1.1,11.85-2.44,23.67-3.81,35.49-1.43,12.31-3,24.61-4.51,36.9q-2.16,17.21-4.43,34.41-2.45,18.67-5,37.34c-4.22,25.54-3.23,51.42-5,77.12q0,.92,0,1.85t0,2.11c0,5,.23,10-.11,15-1.13,16.69,4.2,33,3.12,49.63-.31,4.83.89,9.54,2,14.22a50.66,50.66,0,0,0,2.91,19.14l3,18a27.64,27.64,0,0,1-.36,3.46c-1.85,8-3,16,1.8,23.58a8.18,8.18,0,0,1,1,4.81s1.21-5.56,16.21-8.56,32.84-6.32,42.34-4.07c7,1.65,6.91,1.82,6.91,1.82s-.5-8,.75-11.75a53.85,53.85,0,0,1,2.5-6.27s.58-17.4.58-24.06S298.33,991.33,300,984.67Z","M814.53,878.11c-.78-8.74-1.35-17.49-2.09-26.23-1.09-12.85-2.56-25.66-3.76-38.5-.81-8.73-1.36-17.49-2.16-26.23-1.23-13.5-2.58-27-3.88-40.49-.74-7.74-1.44-15.48-2.25-23.22-1.2-11.5-2.55-23-3.73-34.5-1.13-11-2-22.08-3.21-33.09-1.46-13.14-3.35-26.23-4.74-39.37-1.27-12-1.93-24.08-3.18-36.09-2-19.62-4-39.23-3.93-59,0-1.91.73-4-.94-5.7,0-9.91,1-20-1.27-29.67-3.81-16.19-5.61-32.76-9.69-48.88-.31-1.21-2-5.1-2.1-6.39a3.06,3.06,0,0,0-.51.08,3.06,3.06,0,0,1,.51-.08c-2.63-7.37-6.56-14.13-10-21.1,0-.2-.12-.39-.18-.58-6.23,14.81-15.94,34.65-25,39.9,0,0-4.33,31.67-4,34a76.91,76.91,0,0,1,0,9s-7,24.67-7,27,2.33,5,0,10.67-7,22-8.67,26.67-2,31-2,31l-3.33,41-2.67,37-3.67,39-4,42-2,30S695,793,696.67,800s2,30,2,30,2.33,19,4,24.33S710.33,882,711.33,892s1.33,26.67,3.33,34.33,5.67,30.33,6.67,35.67,2.75,11.33,3.54,20,4.63,36.33,4.63,36.33v19l3.17,22.31c4.45-.7,30.57-4.59,46.08-1.39,17,3.5,18.75,5.25,18.75,5.25l1.09-6.71a164.83,164.83,0,0,0,10-41,160.94,160.94,0,0,0,2.21-17.21c.47-8.75,1.13-17.53,2.14-26.22,1.63-14,2.45-28,3.55-42C817.85,912.91,816.09,895.47,814.53,878.11Z']
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                },
                "3": {
                    "name": "鞋子",
                    "data": {
                        "classify": [
                            "101",
                            "106"
                        ],
                        "list": {
                            "count": 0,
                            "pageSize": 20,
                            "list": [

                            ]
                        }
                    }
                },
                "5": {
                    "name": "家纺",
                    "data": {
                        "classify": [
                            "107",
                            "108"
                        ],
                        "list": {
                            "count": 0,
                            "pageSize": 20,
                            "list": [

                            ]
                        }
                    }
                },
                "100": {
                    "name": "其他",
                    "data": {
                        "classify": [
                            "109",
                            "110"
                        ],
                        "list": {
                            "count": 0,
                            "pageSize": 20,
                            "list": [

                            ]
                        }
                    }
                }
            }

        }

        /* ======================== 起始 ======================== */

        // 页面加载控制
        function loadingToggle(type) {
            if (type === true) {
                def.loadingEl.fadeIn(200);
                def.loadingBgEl.fadeIn(400);
            } else if (type === false) {
                def.loadingEl.fadeOut(200);
                def.loadingBgEl.fadeOut(400);
            } else {
                def.loadingEl.fadeToggle(200);
                def.loadingBgEl.fadeToggle(400);
            }
        }

        loadingToggle(false);

        // 是否选择模板站点
        templateSelectShow();

        // 获取左侧菜单栏
        getLeftmenu();

        // 获取站点分类下模板列表
        getTplListByClassifyId();

        // 我的花型列表接口
        myFlowers();

        // 关闭选择模板站点
        $('.js-select-category-close').on('click', function () {
            toggleSelectCategory();
        })

        // 选择关注品类弹框显示/隐藏
        function toggleSelectCategory(type) {
            if (type === true) {
                $('.js-bg-div,.js-select-category-box').fadeIn();
            } else if (type === false) {
                $('.js-bg-div,.js-select-category-box').fadeOut();
            } else {
                $('.js-bg-div,.js-select-category-box').fadeToggle();
            }
        }

        /* ======================== 侧栏导航 ======================== */
        // console.log(def.asideNavData)

        // 滚动条初始化
        initScrollbarH($(".js-aside-nav-Sb"), true, true).perfectScrollbar();
        initScrollbarH($(".js-aside-control-Sb"), true).perfectScrollbar();
        initScrollbarH($('.js-scroll-Sb'), true).perfectScrollbar();

        // 侧栏导航列表切换
        $('.js-aside-nav-list').on('click', 'li', function () {
            var self = $(this);
            var navListBox = $('.js-aside-nav-content-box').children().eq(self.index());
            self.addClass('on').siblings().removeClass('on');
            navListBox.addClass('on').siblings().removeClass('on');
            // 滚动条初始化
            var sbEl = navListBox.find('.js-aside-nav-Sb');
            if (!sbEl.data('h')) {
                var h = initScrollbarH(sbEl, false, true);
                sbEl.data('h', h).perfectScrollbar('update');
            }
        })

        /**
         * @description: 滚动条初始化
         * @param {Object} el JQ DOM 对象
         * @param {Boolean} type 返回类型 true:dom false:height
         * @param {Boolean} status 是否设置高 true:设置 false:不设置
         * @return: Number / JQ DOM
         */
        function initScrollbarH(el, type, status) {
            if (!el.length) {
                if (type) {
                    return el;
                } else {
                    return 0;
                }
            }
            var h = el.parent().height() - el.position().top - (el.siblings('.js-aside-nav-Sb-next').height() || 0);
            status && el.height(h);
            if (type) {
                return el;
            } else {
                return h;
            }
        }

        /* ======================== 侧栏控制器 ======================== */

        // 收起/展开

        // 拾色器 ========================

        // 绘制色带
        drawRibbon(def.colorRibbonCvs, def.colorRibbonCtx, def.colorRibbonCvs.width, def.colorRibbonCvs.height);

        // 绘制色板
        drawSwatch(def.colorSwatchCtx, def.colorRibbonCtx.getImageData(0, 0, 1, 1).data, def.colorSwatchCvs.width, def.colorSwatchCvs.height);

        // 选择色板色值
        def.colorSwatchCvs.addEventListener("click", function (e) {
            var x = e.offsetX < 0 ? 0 : e.offsetX;
            var y = e.offsetY < 0 ? 0 : e.offsetY;
            if (x >= this.width) {
                x = this.width - 1;
            }
            // spa2.style.top = e.offsetY - spnw / 2 + "px";
            // spa2.style.left = e.offsetX - spnw / 2 + "px";
            def.colorSwatchX = x;
            def.colorSwatchY = y;
            setSwatchVal(def.swatchVal[0], def.swatchVal[1], def.colorSwatchCtx, def.colorSwatchX, def.colorSwatchY);
            e.preventDefault;
            e.stopPropagation();
        }, false);

        /**
         * @description: 绘制色带
         * @param {Object} ctx 色带上下文对象
         * @param {Number} tw 色带宽度
         * @param {Number} th 色带高度
         * @return: 
         */
        function drawRibbon(cvs, ctx, tw, th) {
            var tw = tw;
            while (--tw > -1) {
                ctx.beginPath();
                ctx.strokeStyle = "hsl(" + tw + ",100%,50%)";
                ctx.moveTo(tw + 1, 0);
                ctx.lineTo(tw + 1, th);
                ctx.stroke();
                ctx.closePath();
            }
            // 选择色带色区
            cvs.addEventListener("click", function (e) {
                var x = e.offsetX < 0 ? 0 : e.offsetX;
                var y = e.offsetY < 0 ? 0 : e.offsetY;
                var ndata = ctx.getImageData(x, y, 1, 1);
                drawSwatch(def.colorSwatchCtx, ndata.data, def.colorSwatchCvs.width, def.colorSwatchCvs.height);
                // spa1.style.left = x - Math.floor(spnw / 2) + "px";
                e.preventDefault;
                e.stopPropagation();
            }, false);
            // 色带拖拽
            cvs.addEventListener("mousedown", function (e) {
                def.isDragStart = true;
                e.preventDefault;
                e.stopPropagation();
            }, false);
            cvs.addEventListener("mousemove", function (e) {
                if (def.isDragStart == true) {
                    var x = e.offsetX < 0 ? 0 : e.offsetX;
                    var y = e.offsetY < 0 ? 0 : e.offsetY;
                    var ndata = ctx.getImageData(x, y, 1, 1);
                    drawSwatch(def.colorSwatchCtx, ndata.data, def.colorSwatchCvs.width, def.colorSwatchCvs.height);
                    // spa1.style.left = x - Math.floor(spnw / 2) + "px";
                }
                e.preventDefault;
                e.stopPropagation();
            }, false);
            cvs.addEventListener("mouseup", function (e) {
                if (def.isDragStart == true) {
                    def.isDragStart = false;
                }
                e.preventDefault;
                e.stopPropagation();
            }, false);
            document.body.addEventListener("mouseup", function (e) {
                if (def.isDragStart == true) {
                    def.isDragStart = false;
                }
            }, false);
        }

        /**
         * @description: 绘制色板
         * @param {Object} ctx 色板上下文对象
         * @param {Array} data 颜色数据
         * @param {Number} ow 色板宽度
         * @param {Number} oh 色板高度
         * @return: 
         */
        function drawSwatch(ctx, data, ow, oh) {
            var ow = ow,
                oh = oh,
                r = data[0],
                gg = data[1],
                b = data[2],
                a = data[3],
                img_data = ctx.getImageData(0, 0, ow, oh),
                px_data = img_data.data,
                k = 0,
                v = 0;
            for (var i = 0; i < oh; i++) {
                k = (oh - i) / oh;
                v = 255 * k;
                for (var j = 0; j < ow * 4; j += 4) {
                    px_data[i * ow * 4 + j] = v - (v - r * k) * j / ow / 4 | 0;
                    px_data[i * ow * 4 + j + 1] = v - (v - gg * k) * j / ow / 4 | 0;
                    px_data[i * ow * 4 + j + 2] = v - (v - b * k) * j / ow / 4 | 0;
                    px_data[i * ow * 4 + j + 3] = 255;
                }
            }
            ctx.putImageData(img_data, 0, 0);
            setSwatchVal(def.swatchVal[0], def.swatchVal[1], def.colorSwatchCtx, def.colorSwatchX, def.colorSwatchY);
        };

        /**
         * @description: 设置色板值
         * @param {Object} rgbIpt rgb回显输入框
         * @param {Object} ffIpt 16进制回显输入框
         * @param {Object} ctx 色板上下文对象
         * @param {Number} x 色板x轴坐标点
         * @param {Number} y 色板y轴坐标点
         * @return: 
         */
        function setSwatchVal(rgbIpt, ffIpt, ctx, x, y) {
            var nimg_data = ctx.getImageData(x, y, 1, 1);
            var r = nimg_data.data[0];
            var g = nimg_data.data[1];
            var b = nimg_data.data[2];
            var a = nimg_data.data[3];
            var ff = toFF(r) + toFF(g) + toFF(b);
            rgbIpt.value = r + "," + g + "," + b;
            ffIpt.value = ff;
        };

        /**
         * @description: 转16进制
         * @param {Number} num 2进制数
         * @return: 16进制
         */
        function toFF(num) {
            return num > 16 ? num.toString(16).toUpperCase() : "0" + num.toString(16).toUpperCase();
        };

        /* ======================== 模拟效果部分 ======================== */

        // 获取模板详情接口
        getVirtualDetail();

        var paperSnap = new virtualSnap('#paper');
        // paperSnap.init();

        /* ======================== 接口 ======================== */

        // 是否选择模板站点
        function templateSelectShow() {
            $.ajax({
                url: '/virtualtryon/templateSelectShow/',
                type: 'get',
                dataType: "json",
                success: function (res) {
                    loadingToggle(false);
                    if (res.code === 0) {
                        if (res.data.user_type === 'GENERAL') {
                            toggleSelectCategory(true);
                        }
                    } else {
                        msg.msg({ "txt": data.msg }, 2000);
                    }
                },
                error: function (err) {
                    console.log('for bug: ' + err)
                    loadingToggle(false);
                },
                // complete:function() {
                //     loadingToggle(false);
                // }
            })
        }

        // 获取左侧菜单栏
        function getLeftmenu() {
            $.ajax({
                url: '/virtualtryon/getLeftmenu/',
                type: 'get',
                dataType: "json",
                success: function (res) {
                    if (res.code === 0) {
                        def.asideNavData = res.data
                        for (var i in def.asideNavData) {
                            $('.js-aside-nav-list .async').each(function (idx, v) {
                                if ($(v).data('id') == i) {
                                    $(v).removeClass('async');
                                }
                            })
                            $('.js-aside-nav-content-box .async').each(function (idx, v) {
                                if ($(v).data('id') == i) {
                                    $(v).removeClass('async');
                                    console.log(def.asideNavData[i])
                                }
                            })
                        }
                    } else {
                        msg.msg({ "txt": data.msg }, 2000);
                    }
                },
                error: function (err) {
                    console.log('for bug: ' + err)
                },
                complete: function () {
                    loadingToggle(false);
                }
            })
        }

        // 获取站点分类下模板列表
        function getTplListByClassifyId() {
            $.ajax({
                url: '/virtualtryon/getTplListByClassifyId/',
                type: 'get',
                dataType: "json",
                data: {
                    site: 1,
                    classify_id: '',
                    page: '',
                    pageSize: ''
                },
                success: function (res) {
                    if (res.code === 0) {
                        console.log(res.data)
                    } else {
                        msg.msg({ "txt": data.msg }, 2000);
                    }
                },
                error: function (err) {
                    console.log('for bug: ' + err)
                },
                complete: function () {
                    loadingToggle(false);
                }
            })
        }

        // 我的花型列表接口
        function myFlowers() {
            $.ajax({
                url: '/virtualtryon/myFlowers/',
                type: 'get',
                dataType: "json",
                data: {
                    page: '',
                    pageSize: ''
                },
                success: function (res) {
                    if (res.code === 0) {
                        console.log(res.data)
                    } else {
                        msg.msg({ "txt": data.msg }, 2000);
                    }
                },
                error: function (err) {
                    console.log('for bug: ' + err)
                },
                complete: function () {
                    loadingToggle(false);
                }
            })
        }

        // 获取模板详情接口
        function getVirtualDetail() {
            $.ajax({
                url: '/virtualtryon/getVirtualDetail/',
                type: 'get',
                dataType: "json",
                data: {
                    templateId: 5
                },
                success: function (res) {
                    if (res.code === 0) {
                        console.log(res.data)
                    } else {
                        msg.msg({ "txt": data.msg }, 2000);
                    }
                },
                error: function (err) {
                    console.log('for bug: ' + err)
                },
                complete: function () {
                    loadingToggle(false);
                }
            })
        }

    })

});