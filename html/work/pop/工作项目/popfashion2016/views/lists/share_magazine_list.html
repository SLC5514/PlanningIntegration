{extends file="layout.html"}

{block name="selfcss"}
	<link rel="stylesheet" type="text/css" href="{STATIC_URL2}/global/css/pop_layer.css?{STATIC_CHANGE_TIME}">
	<link rel="stylesheet" type="text/css" href="{STATIC_URL2}/global/css/lists/common/list-common.css?{STATIC_CHANGE_TIME}">
	<link rel="stylesheet" type="text/css" href="{STATIC_URL2}/global/css/lists/books-list.css?{STATIC_CHANGE_TIME}">
{/block}

{block name="main"}
<div class="contant conheight">
	<input type="hidden" id="link" data-col="{$columnId}" data-url="{if isset($link['url'])}{$link['url']}{/if}" data-param="{if isset($link['param'])}{$link['param']}{/if}" data-search="{if isset($link['search'])}{$link['search']}{/if}"/>
    <div name='anchor' id='anchor' class="anchor"></div>
    <div class="banner-top new-banner-top new-banner">
		{block name="topads"}
            {include file="lists/lists-common/banner_ads.html"}
        {/block}
        <!-- 列表导航 -->
		{include file="lists/lists-common/nav_common_select.html"}
    </div>
    <div class="select-common-fixed js-select-common-fixed">
        {include file="lists/lists-common/nav_common_select.html"}
    </div>	
	<div class="right_nav new-right-nav">
		<div class="rightc_top contentW">
            <!-- 列表内容 -->
			{if isset($lists) && !empty($lists)}
			<div class="rightc_main js-book-list-box">				
				<ul class="bookMag clearfix lazyload">
					{foreach $lists as $key=>$val}					
					<li>
						<div class="pic-box">
							<a href="javascript:void(0)" title="{$val.column_title}">
								{if $key>6}
								<img alt="{$val.column_title}" src="{STATIC_URL2}/global/images/loading/book.gif" data-original="{STATIC_URL2}{$val.magazine_cover}">
								{else}
								<img alt="{$val.column_title}" src="{STATIC_URL2}{$val.magazine_cover}">
								{/if}
                            </a>
                            <div class="hover-link">
                                <div>									
									{if $P_UserType==5}
                                    <a class="wz js-general-user-status" href="javascript:void(0);" title="完整浏览"><i></i>完整浏览</a>
                                    {else}
                                    <a itemprop="full browser" class="wz" href="/books/innermaga/id_{$val.url_id}/" data-id="{$val.url_id}" target="_blank"><i></i>完整浏览</a>
                                    {/if}							
								</div>
								<p class="update-time"><img src="{STATIC_URL2}/global/images/lists/books-list/time.png">{$val.pubtime}</p>
                            </div>
						</div>
						<div class="image-title">
							<p class="title click_jump" title="{$val.column_title}">{$val.column_title}</p>
                        </div>
                    </li>
					{/foreach}
				</ul>
			</div>
            {else}            
            <!--  搜索无数据-->
			<div class="rightc_main">
                {include file="lists/lists-common/search_null.html"}
			</div>
            {/if}
            
            <!-- 翻页 -->
			<div class="rightc_bottom">
				<div class="pages">
					{$pageHtml}
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 权限弹出层 -->
<div class="general-user-info-fixbox js-general-user-info-fixbox">
    <div class="contentW">
        <button title="关闭"></button>
        <h3>这本杂志很棒，</h3>
        <p>我们定期更新期刊资源，立即加入POP吧，让研发更多视角，灵感源源不断</p>
        <a class="js-contact-qq-btn" href="javascript:void(0);" title="在线客服">咨询了解VIP，会员体验畅通无阻</a>
        <a href="/member/pagelogin/" title="立即登录">登录/注册 发现免费推荐</a>
        <span>电话咨询 <span>4008-210-500</span></span>
    </div>
</div>
<div id="loadingBg"><div class="noPic"></div></div>
{if $P_UserType eq 5}
<!-- 留资 -->
{include file="common/sem_trends.html"}
{/if}
{/block}

{block name="self"}
<script type="text/javascript" src="{STATIC_URL3}/global/js/fashion/styles.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL2}/global/js/fashion/index.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/fashion/global.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/fashion/util_brand.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/common/template.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/fashion/regionFromSolr.js?{$regionStaticTime}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/fashion/regionAction.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/fashion/mongoBookName.js?{$magazineNameStaticTime}"></script>
<script src="{STATIC_URL3}/global/js/common/banner-slide.js?{STATIC_CHANGE_TIME}"></script>
<script src="{STATIC_URL3}/global/js/lists/list-common.js?{STATIC_CHANGE_TIME}"></script>
<script type="text/javascript" src="{STATIC_URL3}/global/js/sem_phone/sem_phone.js?{STATIC_CHANGE_TIME}"></script>
{literal}
<script type="text/javascript">
	$(function(){
		var Brand={};
		if(typeof(mongoBookName)!="undefined"){
			Brand=mongoBookName;
			utilBrand.config({
				start:'0-9',//初始值
				BrandData:Brand,//所有按首字母为key的书名
				tipName:'书名',
				template:'<li><a onclick="show(this)" data-bra="#brand" data-book="1" title="#title">#brand</a></li>'
			});

			$('.brands_ca').find('.letter').on('mouseenter', function (e) {
				utilBrand.mouseenter($(this));
			});

			$(".brandslist .searInputbox").on('keyup', function () {
				utilBrand.keyup($(this));
			});
		}

		//品牌隐藏重新计算位置
		$('.showbox').each(function(){
			var $self = $(this);
			var $parent=$self.parent('li');
			var selfWid=$self.outerWidth(true);
			var rightWidth=parseInt(document.body.offsetWidth) -parseInt($parent.offset().left);
			var leftWidth = $parent.offset().left;
			var liWid=$(".paixu li").width();
			if(selfWid > rightWidth){
				$self.css('left', -selfWid+liWid+1);
			}else if(selfWid > leftWidth){
				$self.css('left', '-1px');
			}
		});
		/*右侧排序*/
		var paixu=$(".paixu li");
		$(".js-screen-category").on('mouseenter mouseleave', 'li' ,function(e){
			if(e.type == 'mouseenter'){
				$(this).addClass('hover').find('.showbox').stop().css("visibility","visible");
			} else{
				$(this).removeClass('hover').find('.showbox').stop().css("visibility","hidden");
				$(this).find(".js-filter-list").show().siblings("ul").hide();
				$(this).find(".js-search-brand-area").val("搜索热门品牌名").blur();
			}
		});
		$(".js-discovery-contain").show();
		$(".rightc_bottom").show();
		
	});
	//书名
	function show(obj) {
		var bra = oCommon.popReplace( obj.getAttribute('data-bra') );
		var _bra = encodeURIComponent(encodeURIComponent(bra));
		var link = document.getElementById('link');
		var _url = link.getAttribute('data-url');
		var _param = link.getAttribute('data-param');
		var _key = link.getAttribute('data-search');
		_key = _key ? '?key=' + _key : '';
		if (_param != '') {
			// 页码如果存在则将页码参数去掉
			if (_param.indexOf('page_') !== -1) {
				var reg = new RegExp('page_([^-]*)', 'gi');
				_param = _param.replace(reg,'');
			}
			// 不存在则增加
			if (_param.indexOf('boo_') === -1) {
				_param = _param+'-boo_'+_bra;
			}
			// 否则替换
			else {
				var reg = new RegExp('boo_([^-]*)', 'gi');
				_param = _param.replace(reg,'boo_'+_bra);
			}
		}
		else {
			_param = 'boo_'+_bra;
		}
		location.href = _url+_param.replace(/\/$/,'')+'/'+_key+'#anchor';
	}
	//筛选项
	$(".contentHolder").on("click",".clickme",function() {
		var $self = $(this);
		var $link = $("#link");
		var _url = $link.data('url');
		var _param = $link.data('param');
		var _search = $link.data('search');
		var _key = $self.data('key');
		var _val = $self.data('val');

		var pattern = RegExp(_key+'_[a-zA-z0-9]+','gi');
		var flag = false;
		if (_search) {
			_search = '?key='+_search;
		}

        //去除page参数
        var page_pattern = /(-)?page_\d(-)?/;
        if (page_pattern.test(_param)) {
            _param = _param.replace(page_pattern, '');
        }
		if (_param) {
			//替换
			if (pattern.test(_param)) {
				flag = true;
				_param = _param.replace(pattern, _key+'_'+_val);
			}
			if (flag) {
				//原参数中包含参数
				location.href = _url+encodeURIComponent(_param)+'/'+_search+'#anchor';
			}else{
				//原参数中不包含参数
				location.href = _url+encodeURIComponent(_param+'-'+_key+'_'+_val)+'/'+_search+'#anchor';
			}
		}else{
			location.href = _url+encodeURIComponent(_key+'_'+_val)+'/'+_search+'#anchor';
		}
	});

	$(function(){
		$(".lazyload img").lazyload({effect : "fadeIn"});
	});

</script>
{/literal}
{/block}