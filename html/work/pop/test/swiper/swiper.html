<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    body{overflow: hidden;}
    .sp-cube {
      /* -webkit-transform: translateZ(0); */
      -moz-transform: translateZ(0);
      -ms-transform: translateZ(0);
      -o-transform: translateZ(0);
      /* transform: translateZ(0); */
      /* -webkit-backface-visibility: hidden; */
      -moz-backface-visibility: hidden;
      -ms-backface-visibility: hidden;
      /* backface-visibility: hidden; */
      /* -webkit-perspective: 1000; */
      -moz-perspective: 1000;
      -ms-perspective: 1000;
      /* perspective: 1000; */
    }
    .swiper-container{
      width: 2000px;
      height: 200px;
      position: absolute;
      top: 0;
      left: 50%;
      margin-left: -1000px;
      border: 2px solid #666;
      user-select: none;
    }
    .swiper-slide{
      border: 1px solid #ccc;
      background: #e3e3ee;
    }
    .swiper-container-3d .swiper-slide-shadow-left,.swiper-container-3d .swiper-slide-shadow-right{
      background-image: linear-gradient(to left,rgba(0,0,0,.3),rgba(0,0,0,0.3));
      transform: scale(1.6);
    }
    .swiper-button-prev, .swiper-container-rtl .swiper-button-next{
      left: 22%;
    }
    .swiper-button-next, .swiper-container-rtl .swiper-button-prev{
      right: 22%;
    }
    /* 自定义 */
    .sp-box{
      width: 2000px;
      height: 0;
      position: absolute;
      top: 250px;
      left: 50%;
      margin-left: -1000px;
      border: 2px solid #666;
      background: #141C26;
      user-select: none;
      overflow: hidden;
      transition: height 0.3s ease-out;
      -o-transition: height 0.3s ease-out;
      -ms-transition: height 0.3s ease-out;
      -moz-transition: height 0.3s ease-out;
      -webkit-transition: height 0.3s ease-out;
    }
    /* .sp-box.sp-hide{
      height: 0;
    } */
    .sp-wp{
      width: 100%;
      height: 100%;
    }
    .sp-wp.ts {
      -o-transition: margin-left 0.3s ease-out;
      -ms-transition: margin-left 0.3s ease-out;
      -moz-transition: margin-left 0.3s ease-out;
      -webkit-transition: margin-left 0.3s ease-out;
      transition: margin-left 0.3s ease-out;
    }
    .sp-wp.ts .sp-s{
      -o-transition: width height margin 0.3s ease-out;
      -ms-transition: width height margin 0.3s ease-out;
      -moz-transition: width height margin 0.3s ease-out;
      -webkit-transition: width height margin 0.3s ease-out;
      transition: width height margin 0.3s ease-out;
    }
    .sp-s{
      float: left;
      width: 0;
      height: 0;
      border: 1px solid #ccc;
      box-sizing: border-box;
      position: relative;
    }
    .sp-s.on{}
    .sp-gb{
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
    }
    .sp-gb canvas{
      width: 100%!important;
      height: 100%!important;
    }
    .gb-blur {
      position: absolute;
      left: 0;
      top: 0;
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      filter: url(blur-5px.svg#blur);
      -webkit-filter: blur(5px);
      -moz-filter: blur(5px);
      filter: blur(5px);
      filter: progid:DXImageTransform.Microsoft.Blur(PixelRadius=5, MakeShadow=false);
      *left: -5px;
      *top: -5px;
      left: -5px\0;
      top: -5px\0;
    }
    :root .gb-blur {
      left: -5px\0;
      top: -5px\0;
    }
    .gb-blur image {
      -o-transition: all 0.3s ease-out;
      -ms-transition: all 0.3s ease-out;
      -moz-transition: all 0.3s ease-out;
      -webkit-transition: all 0.3s ease-out;
      transition: all 0.3s ease-out;
    }
    .sp-cp {
      position: absolute;
      overflow: hidden;
      -o-transition: width height top right 0.3s ease-out;
      -ms-transition: width height top right 0.3s ease-out;
      -moz-transition: width height top right 0.3s ease-out;
      -webkit-transition: width height top right 0.3s ease-out;
      transition: width height top right 0.3s ease-out;
      border: 1px solid #ccc;
    }
    .sp-sd-l,.sp-sd-r{
      width: 0;
      height: 100%;
      background-color: #000;
      opacity: 0.3;
      filter: alpha(opacity=30);
      position: absolute;
      top: 0;
      -o-transition: width 0.3s ease-out;
      -ms-transition: width 0.3s ease-out;
      -moz-transition: width 0.3s ease-out;
      -webkit-transition: width 0.3s ease-out;
      transition: width 0.3s ease-out;
    }
    .sp-sd-l{left: 0;}
    .sp-sd-r{right: 0;}
    .sp-prev,.sp-next{
      width: 30px;
      height: 60px;
      background: #ccc;
      position: absolute;
      top: 50%;
      margin-top: -30px;
      cursor: pointer;
    }
    .sp-prev{
      left: 24%;
      -o-transition: left 0.3s ease-out;
      -ms-transition: left 0.3s ease-out;
      -moz-transition: left 0.3s ease-out;
      -webkit-transition: left 0.3s ease-out;
      transition: left 0.3s ease-out;
    }
    .sp-next{
      right: 24%;
      -o-transition: right 0.3s ease-out;
      -ms-transition: right 0.3s ease-out;
      -moz-transition: right 0.3s ease-out;
      -webkit-transition: right 0.3s ease-out;
      transition: right 0.3s ease-out;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="sp-box sp1">
      <svg style="width: 0;height: 0;display: none;" version="1.1">
        <defs>
          <filter id="blur">
            <feGaussianBlur stdDeviation="5" />
          </filter>
        </defs>
      </svg>
      <div class="sp-wp"></div>
      <div class="sp-sd-l"></div>
      <div class="sp-sd-r"></div>
      <div class="sp-prev"></div>
      <div class="sp-next"></div>
    </div>
    <button class="prev">prev</button>
    <button class="next">next</button>
  </div>
</body>
<script src="./jquery-1.12.4.min.js"></script>
<script>
var imgList = [
  {
    url: './bg1-6.jpg'
  },
  {
    url: './banner01.jpg',
    gb: {
      w: 300,
      h: 200,
      x: 10,
      y: 10
    }
  },
  {
    url: './banner01.jpg',
    gb: {
      w: 400,
      h: 300,
      x: 20,
      y: 20
    }
  },
  {
    url: './banner01.jpg',
    gb: {
      w: 400,
      h: 300,
      x: 20,
      y: 20
    }
  },
  {
    url: './banner01.jpg',
    gb: {
      w: 500,
      h: 300,
      x: 50,
      y: 50
    }
  }
]

var SpCom = function(options) {
  var self = this;
  this.$options = {
    el: '.sp-box', // 绑定元素
    prevEl: '.sp-prev', // 前一个按钮
    nextEl: '.sp-next', // 后一个按钮
    prevSd: '.sp-sd-l', // 前一个遮罩
    nextSd: '.sp-sd-r', // 后一个遮罩
    time: 300, // 延迟时间ms
    playTime: 3000, // 自动播时间
    lrRemove: 30, // 左右按钮与展示块的距离
    count: 0, // 当前下标
    showSlide: 3, // 展示的块数
    space: 10, // 展示块的间距
    sw: 300, // 子块宽度
    sh: 200, // 子块高度
    scale: 0.8, // 子块的缩放比
    gb: {
      w: 0, // 子块截取的图片宽度
      h: 0, // 子块截取的图片高度
      x: 0, // 子块图片的x坐标
      y: 0  // 子块图片的y坐标
    },
    radius: 40, // 模糊半径
    imgList: [], // 数据列表
    cpSize: 150, // 截取块宽高
    cpT: 20, // 截取块top值
    cpR: 20, // 截取块right值
    isSvg: false, // 高斯模糊是否为svg
  }
  this.$options = $.extend(this.$options, options);
  if (this.$options.imgList.length < 3) {
    return;
  } else if (this.$options.imgList.length == 3) {
    $(this.$options.prevEl).hide();
    $(this.$options.nextEl).hide();
  }
  console.log(this.$options)
  this.$count = this.$options.count;
  this.$el = $(this.$options.el);
  this.$prevEl = $(this.$options.prevEl);
  this.$nextEl = $(this.$options.nextEl);
  this.$prevSd = $(this.$options.prevSd);
  this.$nextSd = $(this.$options.nextSd);
  this.$broswerMsg = this.getBroswer();
  this.$w = this.$el.width();
  this.$wp = this.$el.find('.sp-wp');
  this.prevInit();
  this.$childAll = null;
  this.$child = this.$el.find('.sp-s');
  this.$len = this.$child.length;
  this.$clickType = false;
  this.$timeIn = null;
  this.$timeout = null;
  this.$timeoutClick = null;
  this.$timeoutCb = null;
  this.$minW = this.$options.sw + this.$options.space*2;
  this.$maxW = this.$minW*this.$options.showSlide;
  this.$scaleM = (this.$options.sw + this.$options.space*2 - this.$options.sw*this.$options.scale)/2;
  this.$sdWidth = (this.$w - (this.$minW*this.$options.showSlide - this.$options.space*2))/2;
  this.init();
}
SpCom.prototype = {
  prevInit: function() {
    var childEl = '', imageEl = new Image(), cpEl = '', gbimgStyle = '', cpimgStyle = '';
    var spCss3 = this.supportCss3('background-size');
    for (var i = 0; i < this.$options.imgList.length; i++) {
      imageEl.src = this.$options.imgList[i].url;
      if (!spCss3) {
        if (imageEl.width < imageEl.height) {
          cpimgStyle = 'style="width:100%;margin-top:-' + (imageEl.height*this.$options.cpSize/imageEl.width - this.$options.cpSize)/2 + 'px;"';
        } else {
          cpimgStyle = 'style="height:100%;margin-left:-' + (imageEl.width*this.$options.cpSize/imageEl.height - this.$options.cpSize)/2 + 'px;"';
        }
        cpEl = '<div class="sp-cp sp-cube" style="width:' + this.$options.cpSize*this.$options.scale + 
          'px;height:' + this.$options.cpSize*this.$options.scale + 
          'px;top:' + this.$options.cpT*this.$options.scale + 
          'px;right:' + this.$options.cpR*this.$options.scale + 'px;">' + 
            '<img src="'+ this.$options.imgList[i].url +'" ' + cpimgStyle + ' />' + 
          '</div>';
      } else {
        cpEl = '<div class="sp-cp sp-cube" style="width:' + this.$options.cpSize*this.$options.scale + 
        'px;height:' + this.$options.cpSize*this.$options.scale + 
        'px;top:' + this.$options.cpT*this.$options.scale + 
        'px;right:' + this.$options.cpR*this.$options.scale + 
        'px;background: url('+ this.$options.imgList[i].url +') no-repeat center/cover;"></div>';
      }
      if (imageEl.width > imageEl.height) {
        gbimgStyle = 'style="height:100%;margin-left:-' + ((imageEl.width*this.$options.sh/imageEl.height - this.$options.sw)/2 || 0) + 'px;"';
      } else {
        gbimgStyle = 'style="width:100%;margin-top:-' + ((imageEl.height*this.$options.sw/imageEl.width - this.$options.sh)/2 || 0) + 'px;"';
      }
      childEl += '<div class="sp-s sp-cube">' +
          '<div class="sp-gb sp-cube">' +
            // '<img src="'+ this.$options.imgList[i].url +'" ' + gbimgStyle + ' />' +
            '<img class="gb-blur" src="'+ this.$options.imgList[i].url +'" ' + gbimgStyle + ' />' +
          '</div>' + cpEl +
        '</div>';
    }
    this.$wp.html(childEl);
  },
  init: function() {
    var self = this;
    this.$prevSd.css({'width': this.$sdWidth + 'px'});
    this.$nextSd.css({'width': this.$sdWidth + 'px'});
    this.$prevEl.css({'left': this.$sdWidth - this.$prevEl.width() - this.$options.lrRemove + 'px'});
    this.$nextEl.css({'right': this.$sdWidth - this.$nextEl.width() - this.$options.lrRemove + 'px'});
    this.$wp.css('width', (this.$len + this.$options.showSlide*4) * (this.$options.sw + this.$options.space*2) + 'px');

    for (var i = 0; i < this.$child.length; i++) {
      $(this.$child[i]).attr('data-count', i);
      if (i >= this.$count && i < this.$count + this.$options.showSlide) {
        $(this.$child[i]).addClass('on').css({
          'width': this.$options.sw + 'px',
          'height': this.$options.sh + 'px',
          'margin': '0 ' + this.$options.space + 'px'
        }).find('.sp-cp').css({
          'width': this.$options.cpSize + 'px',
          'height': this.$options.cpSize + 'px',
          'top': this.$options.cpT + 'px',
          'right': this.$options.cpR + 'px'
        });
      } else {
        // 宽高调整法
        $(this.$child[i]).css({
          'width': this.$options.sw*this.$options.scale + 'px',
          'height': this.$options.sh*this.$options.scale + 'px',
          'margin': (this.$options.sh - this.$options.sh*this.$options.scale)/2 + 'px ' + this.$scaleM + 'px'
        });
      }
    }

    this.$wp.css('margin-left', -(this.$minW*(this.$count + this.$options.showSlide*2) - this.$sdWidth + this.$options.space) + 'px');

    if (this.$len < this.$options.showSlide*2) {
      this.$wp.prepend(this.$child.slice(-this.$options.showSlide*2).clone(false));
      this.$wp.prepend(this.$child.slice(-(this.$options.showSlide*2 - this.$len)).clone(false));
      this.$wp.append(this.$child.slice(0, this.$options.showSlide*2).clone(false));
      this.$wp.append(this.$child.slice(0, this.$options.showSlide*2 - this.$len).clone(false));
    } else {
      this.$wp.prepend(this.$child.slice(-this.$options.showSlide*2).clone(false));
      this.$wp.append(this.$child.slice(0, this.$options.showSlide*2).clone(false));
    }
    this.$childAll = this.$el.find('.sp-s');
    if (this.$len < 5) {
      var el,idx;
      var count = this.$options.showSlide*2;
      var hasOnList = this.$childAll.filter('.on');
      for (var i = 0,len = hasOnList.length; i < len; i++) {
        el = $(hasOnList[i]);
        idx = el.index();
        if (idx < count || idx >= count + 3) {
          this.changeOn(el);
        }
      }
    }
    if (this.$len == 3) {
      this.$childAll.filter('[class!="sp-s sp-cube on"]').css({'visibility': 'hidden'});
    }

    // 高斯模糊
    this.blurInit();

    this.$timeout = setTimeout(function() {
      self.$wp.addClass('ts');
      self.$childAll.css('transition-duration', self.$options.time + 'ms').find('.sp-cp').css('transition-duration', self.$options.time + 'ms');
      self.$el.css({'height': self.$options.sh + 'px'});
      clearTimeout(self.$timeout);
    }, 0);

    this.$prevEl.on('click', function(e) {
      if (self.$clickType) {
        return false;
      }
      self.$clickType = true;
      self.$timeoutClick = setTimeout(function() {
        self.$clickType = false;
        clearTimeout(self.$timeoutClick);
      }, self.$options.time + 50);
      self.prev();
    });
    this.$nextEl.on('click', function(e) {
      if (self.$clickType) {
        return false;
      }
      self.$clickType = true;
      self.$timeoutClick = setTimeout(function() {
        self.$clickType = false;
        clearTimeout(self.$timeoutClick);
      }, self.$options.time + 50);
      self.next();
    });
    
    // this.$timeIn = setInterval(function() {
    //   self.next(1);
    // }, this.$options.playTime);

    // this.$el.hover(function() {
    //   clearInterval(self.$timeIn);
    // }, function(e) {
    //   self.$timeIn = setInterval(function() {
    //     self.next(1);
    //   }, self.$options.playTime);
    // })
    $('.prev').on('click', function() {
      self.prev(1);
    })
    $('.next').on('click', function() {
      self.next(1);
    })
  },
  blurInit: function() {
    //IE10+ blur
    if (typeof document.msHidden != "undefined") {
      this.isSvg = true;
      var blurList = this.$childAll.find(".gb-blur");
      var imageEl = null;
      var imgEl = new Image();
      var imgSrc = '';
      var gbImgStyle = '';
      var hasOn = false;
      var mw,mh,mx,my,sw,sh,sx,sy;
      for (var i = 0, len = blurList.length; i < len; i++) {
        imgSrc = blurList[i].src;
        imgEl.src = blurList[i].src;
        imageEl = $(blurList[i]).prev()[0];
        hasOn = $(blurList[i]).parents('.sp-s').hasClass('on');
        $(blurList[i]).css('display', 'none');
        if (imgEl.height > 0) {
          mw = imgEl.width*this.$options.sh/imgEl.height;
          mh = imgEl.height*this.$options.sw/imgEl.width;
          mx = -(imgEl.width*this.$options.sh/imgEl.height - this.$options.sw)/2;
          my = -(imgEl.height*this.$options.sw/imgEl.width - this.$options.sh)/2;
          sw = mw*this.$options.scale;
          sh = mh*this.$options.scale;
          sx = mx*this.$options.scale;
          sy = my*this.$options.scale;
        } else {
          mw = '100%';
          mh = '100%';
          mx = 0;
          my = 0;
          sw = '100%';
          sh = '100%';
          sx = 0;
          sy = 0;
        }
        if (!hasOn) {
          if (imgEl.width > imgEl.height) {
            gbImgStyle = 'width="' + sw + '" height="100%" x="' + sx + '" y="0" data-sw="' + sw + '" data-sh="100%" data-sx="' + sx + '" data-sy="0" data-mw="' + mw + '" data-mh="100%" data-mx="' + mx + '" data-my="0"';
          } else {
            gbImgStyle = 'width="100%" height="' + sh + '" x="0" y="' + sy + '" data-sw="100%" data-sh="' + sh + '" data-sx="0" data-sy="' + sy + '" data-mw="100%" data-mh="' + mh + '" data-mx="0" data-my="' + my + '"';
          }
        } else {
          if (imgEl.width > imgEl.height) {
            gbImgStyle = 'width="' + mw + '" height="100%" x="' + mx + '" y="0" data-sw="' + sw + '" data-sh="100%" data-sx="' + sx + '" data-sy="0" data-mw="' + mw + '" data-mh="100%" data-mx="' + mx + '" data-my="0"';
          } else {
            gbImgStyle = 'width="100%" height="' + mh + '" x="0" y="' + my + '" data-sw="100%" data-sh="' + sh + '" data-sx="0" data-sy="' + sy + '" data-mw="100%" data-mh="' + mh + '" data-mx="0" data-my="' + my + '"';
          }
        }
        blurList[i].insertAdjacentHTML("afterend", '<svg class="gb-blur" width="100%" height="100%" style="left:0;top:0;">\
          <image xlink:href="'+ imgSrc + '" src="' + imgSrc + '" ' + gbImgStyle + ' filter="url(#blur)" />\
        </svg>');
      }
    }
  },
  to: function(w, type, callback) {
    var self = this;
    var hasNum = 0;
    var count = 0;
    var countEl = null;
    var hasOn = false;
    var blurImgList = this.$childAll.find("svg.gb-blur>image");
    var l = parseFloat(this.$wp.css('margin-left'));
    this.changeOn(this.$childAll);
    var num = type ? - (this.$len - this.$count) : this.$count;
    if (num < -1) {
      hasNum = this.$len + num;
    } else {
      hasNum = type ? - (this.$len - this.$count) : this.$count;
    }
    for (var i = 0; i < this.$options.showSlide; i++) {
      count = this.$count + i;
      countEl = this.$childAll.filter('[data-count=' + (count >= this.$len ? count - this.$len : count) + ']');
      this.changeOn(countEl, true);
    }

    if (this.isSvg) {
      var svgImgEl,svgData;
      for (var i = 0, len = blurImgList.length; i < len; i++) {
        svgImgEl = $(blurImgList[i]);
        svgData = svgImgEl.data();
        hasOn = svgImgEl.parents('.sp-s').hasClass('on');
        if (!hasOn) {
          svgImgEl.attr({
            width: svgData.sw,
            height: svgData.sh,
            x: svgData.sx,
            y: svgData.sy,
          })
        } else {
          svgImgEl.attr({
            width: svgData.mw,
            height: svgData.mh,
            x: svgData.mx,
            y: svgData.my,
          })
        }
      }
    }

    this.$wp.css('margin-left', l + w + 'px');

    if (this.$broswerMsg.broswer == 'IE' && parseInt(this.$broswerMsg.version) < 10) {
      callback(self, hasNum);
      if (self.$len < 5) {
        var el,idx;
        var count = self.$options.showSlide*2 + hasNum;
        var hasOnList = self.$childAll.filter('.on');
        for (var i = 0,len = hasOnList.length; i < len; i++) {
          el = $(hasOnList[i]);
          idx = el.index();
          if (idx < count || idx >= count + 3) {
            self.changeOn(el);
          }
        }
      }
    } else {
      this.$timeout = setTimeout(function() {
        callback(self, hasNum);
        if (self.$len < 5) {
          var el,idx;
          var count = self.$options.showSlide*2 + hasNum;
          var hasOnList = self.$childAll.filter('.on');
          for (var i = 0,len = hasOnList.length; i < len; i++) {
            el = $(hasOnList[i]);
            idx = el.index();
            if (idx < count || idx >= count + 3) {
              self.changeOn(el);
            }
          }
        }
        clearTimeout(self.$timeout);
      }, this.$options.time);
    }
  },
  prev: function(type) {
    var self = this;
    var callback = function(){return false;};
    this.$count -= type ? 1 : this.$options.showSlide;
    // console.log(this.$count, 'prev')
    if (this.$count < 0) {
      callback = this.cback();
      this.$count += this.$len;
    } else if (this.$count == 0) {
      callback = this.cback();
    }
    // console.log(this.$count)
    this.to(type ? this.$minW : this.$maxW, 0, callback);
  },
  next: function(type) {
    var self = this;
    var callback = function(){return false;};
    this.$count += type ? 1 : this.$options.showSlide;
    // console.log(this.$count, this.$len, 'next')
    if (this.$count + this.$options.showSlide > this.$len) {
      // console.log(this.$count)
      callback = this.cback();
      if (this.$count > this.$len) {
        this.$count -= this.$len;
      }
    }
    this.to(-(type ? this.$minW : this.$maxW), 1, callback);
  },
  cback: function() {
    var self = this;
    var callback = function(self, hasNum) {
      self.cbcom(self, hasNum);
    }
    return callback;
  },
  cbcom: function(self, hasNum) {
    var left = self.$minW*(hasNum + self.$options.showSlide*2) - self.$sdWidth + self.$options.space;
    self.$wp.removeClass('ts').css({'transition-duration': ''});
    self.$wp.css('margin-left', -left + 'px');
    self.$timeoutCb = setTimeout(function() {
      self.$wp.addClass('ts').css({'transition-duration': self.$options.time + 'ms'});
      clearTimeout(self.$timeoutCb);
    }, 100);
  },
  changeOn: function(el, type) {
    if (type) {
      el.addClass('on').css({
        'width': this.$options.sw + 'px',
        'height': this.$options.sh + 'px',
        'margin': '0 ' + this.$options.space + 'px'
      }).find('.sp-cp').css({
        'width': this.$options.cpSize + 'px',
        'height': this.$options.cpSize + 'px',
        'top': this.$options.cpT + 'px',
        'right': this.$options.cpR + 'px'
      })
    } else {
      el.removeClass('on').css({
        'width': this.$options.sw*this.$options.scale + 'px',
        'height': this.$options.sh*this.$options.scale + 'px',
        'margin': (this.$options.sh - this.$options.sh*this.$options.scale)/2 + 'px ' + this.$scaleM + 'px'
      }).find('.sp-cp').css({
        'width': this.$options.cpSize*this.$options.scale + 'px',
        'height': this.$options.cpSize*this.$options.scale + 'px',
        'top': this.$options.cpT*this.$options.scale + 'px',
        'right': this.$options.cpR*this.$options.scale + 'px'
      })
    }
  },
  supportCss3: function(style) {
    var prefix = ['webkit', 'Moz', 'ms', 'o'],
      i,
      humpString = [],
      htmlStyle = document.documentElement.style,
      _toHumb = function (string) {
        return string.replace(/-(\w)/g, function ($0, $1) {
          return $1.toUpperCase();
        });
      };
    for (i in prefix){
      humpString.push(_toHumb(prefix[i] + '-' + style));
    }
    humpString.push(_toHumb(style));
    for (i in humpString){
      if (humpString[i] in htmlStyle) return true;
    }
    return false;
  },
  getBroswer: function(){
    var sys = {};
    var ua = navigator.userAgent.toLowerCase();
    var s;
    (s = ua.match(/edge\/([\d.]+)/)) ? sys.edge = s[1] :
    (s = ua.match(/rv:([\d.]+)\) like gecko/)) ? sys.ie = s[1] :
    (s = ua.match(/msie ([\d.]+)/)) ? sys.ie = s[1] :
    (s = ua.match(/firefox\/([\d.]+)/)) ? sys.firefox = s[1] :
    (s = ua.match(/chrome\/([\d.]+)/)) ? sys.chrome = s[1] :
    (s = ua.match(/opera.([\d.]+)/)) ? sys.opera = s[1] :
    (s = ua.match(/version\/([\d.]+).*safari/)) ? sys.safari = s[1] : 0;

    if (sys.edge) return { broswer : "Edge", version : sys.edge };
    if (sys.ie) return { broswer : "IE", version : sys.ie };
    if (sys.firefox) return { broswer : "Firefox", version : sys.firefox };
    if (sys.chrome) return { broswer : "Chrome", version : sys.chrome };
    if (sys.opera) return { broswer : "Opera", version : sys.opera };
    if (sys.safari) return { broswer : "Safari", version : sys.safari };
    
    return { broswer : "", version : "0" };
  },
  // 高斯模糊 (模式2)
  mul_table: [
    512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,
    454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,
    482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,
    437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,
    497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,
    320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,
    446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,
    329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,
    505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,
    399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,
    324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,
    268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,
    451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,
    385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,
    332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,
    289,287,285,282,280,278,275,273,271,269,267,265,263,261,259
  ],
  shg_table: [
    9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 
    17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 
    19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,
    20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
    21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,
    21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 
    22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
    22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 
    23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
    23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
    23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 
    23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 
    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24
  ],
  // (图片, canvas, 模糊的半径大小, 透明通道是否要模糊, 截取的图片坐标及大小)
  stackBlurImage: function(imageEl, canvasEl, radius, blurAlphaChannel, gbObj) {
    var self = this;
    var img = imageEl;
    var canvas = canvasEl;
    var context = canvas.getContext("2d");
    var w = img.naturalWidth;
    var h = img.naturalHeight;
    canvas.width = w;
    canvas.height = h;
    img.onload = function() {
      context.clearRect( 0, 0, w, h );
      context.drawImage( img, gbObj.x, gbObj.y, gbObj.w || w, gbObj.h || h, 0, 0, w, h );
      if ( isNaN(radius) || radius < 1 ) return;
      if ( blurAlphaChannel ) {
        self.stackBlurCanvasRGBA( canvasEl, 0, 0, w, h, radius )
      } else {
        self.stackBlurCanvasRGB( canvasEl, 0, 0, w, h, radius )
      };
    }
  },
  stackBlurCanvasRGBA: function(canvasEl, top_x, top_y, width, height, radius) {
    if ( isNaN(radius) || radius < 1 ) return;
    radius |= 0;
    
    var canvas  = canvasEl;
    var context = canvas.getContext("2d");
    var imageData;
    
    try {
      try {
      imageData = context.getImageData( top_x, top_y, width, height );
      } catch(e) {
      
      // NOTE: this part is supposedly only needed if you want to work with local files
      // so it might be okay to remove the whole try/catch block and just use
      // imageData = context.getImageData( top_x, top_y, width, height );
      try {
        netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
        imageData = context.getImageData( top_x, top_y, width, height );
      } catch(e) {
        alert("Cannot access local image");
        throw new Error("unable to access local image data: " + e);
        return;
      }
      }
    } catch(e) {
      alert("Cannot access image");
      throw new Error("unable to access image data: " + e);
    }
    
    var pixels = imageData.data;
    
    var x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum, a_sum, 
    r_out_sum, g_out_sum, b_out_sum, a_out_sum,
    r_in_sum, g_in_sum, b_in_sum, a_in_sum, 
    pr, pg, pb, pa, rbs;
    
    var div = radius + radius + 1;
    var w4 = width << 2;
    var widthMinus1  = width - 1;
    var heightMinus1 = height - 1;
    var radiusPlus1  = radius + 1;
    var sumFactor = radiusPlus1 * ( radiusPlus1 + 1 ) / 2;
    
    var stackStart = new this.BlurStack();
    var stack = stackStart;
    for ( i = 1; i < div; i++ )
    {
      stack = stack.next = new this.BlurStack();
      if ( i == radiusPlus1 ) var stackEnd = stack;
    }
    stack.next = stackStart;
    var stackIn = null;
    var stackOut = null;
    
    yw = yi = 0;
    
    var mul_sum = this.mul_table[radius];
    var shg_sum = this.shg_table[radius];
    
    for ( y = 0; y < height; y++ )
    {
      r_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;
      
      r_out_sum = radiusPlus1 * ( pr = pixels[yi] );
      g_out_sum = radiusPlus1 * ( pg = pixels[yi+1] );
      b_out_sum = radiusPlus1 * ( pb = pixels[yi+2] );
      a_out_sum = radiusPlus1 * ( pa = pixels[yi+3] );
      
      r_sum += sumFactor * pr;
      g_sum += sumFactor * pg;
      b_sum += sumFactor * pb;
      a_sum += sumFactor * pa;
      
      stack = stackStart;
      
      for( i = 0; i < radiusPlus1; i++ )
      {
        stack.r = pr;
        stack.g = pg;
        stack.b = pb;
        stack.a = pa;
        stack = stack.next;
      }
      
      for( i = 1; i < radiusPlus1; i++ )
      {
        p = yi + (( widthMinus1 < i ? widthMinus1 : i ) << 2 );
        r_sum += ( stack.r = ( pr = pixels[p])) * ( rbs = radiusPlus1 - i );
        g_sum += ( stack.g = ( pg = pixels[p+1])) * rbs;
        b_sum += ( stack.b = ( pb = pixels[p+2])) * rbs;
        a_sum += ( stack.a = ( pa = pixels[p+3])) * rbs;
        
        r_in_sum += pr;
        g_in_sum += pg;
        b_in_sum += pb;
        a_in_sum += pa;
        
        stack = stack.next;
      }
      
      
      stackIn = stackStart;
      stackOut = stackEnd;
      for ( x = 0; x < width; x++ )
      {
        pixels[yi+3] = pa = (a_sum * mul_sum) >> shg_sum;
        if ( pa != 0 )
        {
          pa = 255 / pa;
          pixels[yi]   = ((r_sum * mul_sum) >> shg_sum) * pa;
          pixels[yi+1] = ((g_sum * mul_sum) >> shg_sum) * pa;
          pixels[yi+2] = ((b_sum * mul_sum) >> shg_sum) * pa;
        } else {
          pixels[yi] = pixels[yi+1] = pixels[yi+2] = 0;
        }
        
        r_sum -= r_out_sum;
        g_sum -= g_out_sum;
        b_sum -= b_out_sum;
        a_sum -= a_out_sum;
        
        r_out_sum -= stackIn.r;
        g_out_sum -= stackIn.g;
        b_out_sum -= stackIn.b;
        a_out_sum -= stackIn.a;
        
        p =  ( yw + ( ( p = x + radius + 1 ) < widthMinus1 ? p : widthMinus1 ) ) << 2;
        
        r_in_sum += ( stackIn.r = pixels[p]);
        g_in_sum += ( stackIn.g = pixels[p+1]);
        b_in_sum += ( stackIn.b = pixels[p+2]);
        a_in_sum += ( stackIn.a = pixels[p+3]);
        
        r_sum += r_in_sum;
        g_sum += g_in_sum;
        b_sum += b_in_sum;
        a_sum += a_in_sum;
        
        stackIn = stackIn.next;
        
        r_out_sum += ( pr = stackOut.r );
        g_out_sum += ( pg = stackOut.g );
        b_out_sum += ( pb = stackOut.b );
        a_out_sum += ( pa = stackOut.a );
        
        r_in_sum -= pr;
        g_in_sum -= pg;
        b_in_sum -= pb;
        a_in_sum -= pa;
        
        stackOut = stackOut.next;

        yi += 4;
      }
      yw += width;
    }

    for ( x = 0; x < width; x++ )
    {
      g_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;
      
      yi = x << 2;
      r_out_sum = radiusPlus1 * ( pr = pixels[yi]);
      g_out_sum = radiusPlus1 * ( pg = pixels[yi+1]);
      b_out_sum = radiusPlus1 * ( pb = pixels[yi+2]);
      a_out_sum = radiusPlus1 * ( pa = pixels[yi+3]);
      
      r_sum += sumFactor * pr;
      g_sum += sumFactor * pg;
      b_sum += sumFactor * pb;
      a_sum += sumFactor * pa;
      
      stack = stackStart;
      
      for( i = 0; i < radiusPlus1; i++ )
      {
        stack.r = pr;
        stack.g = pg;
        stack.b = pb;
        stack.a = pa;
        stack = stack.next;
      }
      
      yp = width;
      
      for( i = 1; i <= radius; i++ )
      {
        yi = ( yp + x ) << 2;
        
        r_sum += ( stack.r = ( pr = pixels[yi])) * ( rbs = radiusPlus1 - i );
        g_sum += ( stack.g = ( pg = pixels[yi+1])) * rbs;
        b_sum += ( stack.b = ( pb = pixels[yi+2])) * rbs;
        a_sum += ( stack.a = ( pa = pixels[yi+3])) * rbs;
        
        r_in_sum += pr;
        g_in_sum += pg;
        b_in_sum += pb;
        a_in_sum += pa;
        
        stack = stack.next;
      
        if( i < heightMinus1 )
        {
          yp += width;
        }
      }
      
      yi = x;
      stackIn = stackStart;
      stackOut = stackEnd;
      for ( y = 0; y < height; y++ )
      {
        p = yi << 2;
        pixels[p+3] = pa = (a_sum * mul_sum) >> shg_sum;
        if ( pa > 0 )
        {
          pa = 255 / pa;
          pixels[p]   = ((r_sum * mul_sum) >> shg_sum ) * pa;
          pixels[p+1] = ((g_sum * mul_sum) >> shg_sum ) * pa;
          pixels[p+2] = ((b_sum * mul_sum) >> shg_sum ) * pa;
        } else {
          pixels[p] = pixels[p+1] = pixels[p+2] = 0;
        }
        
        r_sum -= r_out_sum;
        g_sum -= g_out_sum;
        b_sum -= b_out_sum;
        a_sum -= a_out_sum;
        
        r_out_sum -= stackIn.r;
        g_out_sum -= stackIn.g;
        b_out_sum -= stackIn.b;
        a_out_sum -= stackIn.a;
        
        p = ( x + (( ( p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1 ) * width )) << 2;
        
        r_sum += ( r_in_sum += ( stackIn.r = pixels[p]));
        g_sum += ( g_in_sum += ( stackIn.g = pixels[p+1]));
        b_sum += ( b_in_sum += ( stackIn.b = pixels[p+2]));
        a_sum += ( a_in_sum += ( stackIn.a = pixels[p+3]));
        
        stackIn = stackIn.next;
        
        r_out_sum += ( pr = stackOut.r );
        g_out_sum += ( pg = stackOut.g );
        b_out_sum += ( pb = stackOut.b );
        a_out_sum += ( pa = stackOut.a );
        
        r_in_sum -= pr;
        g_in_sum -= pg;
        b_in_sum -= pb;
        a_in_sum -= pa;
        
        stackOut = stackOut.next;
        
        yi += width;
      }
    }
    
    context.putImageData( imageData, top_x, top_y );
  },
  stackBlurCanvasRGB: function(canvasEl, top_x, top_y, width, height, radius) {
    if ( isNaN(radius) || radius < 1 ) return;
    radius |= 0;
    
    var canvas  = canvasEl;
    var context = canvas.getContext("2d");
    var imageData;
    
    try {
      try {
      imageData = context.getImageData( top_x, top_y, width, height );
      } catch(e) {
      
      // NOTE: this part is supposedly only needed if you want to work with local files
      // so it might be okay to remove the whole try/catch block and just use
      // imageData = context.getImageData( top_x, top_y, width, height );
      try {
        netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
        imageData = context.getImageData( top_x, top_y, width, height );
      } catch(e) {
        alert("Cannot access local image");
        throw new Error("unable to access local image data: " + e);
        return;
      }
      }
    } catch(e) {
      alert("Cannot access image");
      throw new Error("unable to access image data: " + e);
    }
    
    var pixels = imageData.data;
    
    var x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum,
    r_out_sum, g_out_sum, b_out_sum,
    r_in_sum, g_in_sum, b_in_sum,
    pr, pg, pb, rbs;
    
    var div = radius + radius + 1;
    var w4 = width << 2;
    var widthMinus1  = width - 1;
    var heightMinus1 = height - 1;
    var radiusPlus1  = radius + 1;
    var sumFactor = radiusPlus1 * ( radiusPlus1 + 1 ) / 2;
    
    var stackStart = new this.BlurStack();
    var stack = stackStart;
    for ( i = 1; i < div; i++ )
    {
      stack = stack.next = new this.BlurStack();
      if ( i == radiusPlus1 ) var stackEnd = stack;
    }
    stack.next = stackStart;
    var stackIn = null;
    var stackOut = null;
    
    yw = yi = 0;
    
    var mul_sum = this.mul_table[radius];
    var shg_sum = this.shg_table[radius];
    
    for ( y = 0; y < height; y++ )
    {
      r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;
      
      r_out_sum = radiusPlus1 * ( pr = pixels[yi] );
      g_out_sum = radiusPlus1 * ( pg = pixels[yi+1] );
      b_out_sum = radiusPlus1 * ( pb = pixels[yi+2] );
      
      r_sum += sumFactor * pr;
      g_sum += sumFactor * pg;
      b_sum += sumFactor * pb;
      
      stack = stackStart;
      
      for( i = 0; i < radiusPlus1; i++ )
      {
        stack.r = pr;
        stack.g = pg;
        stack.b = pb;
        stack = stack.next;
      }
      
      for( i = 1; i < radiusPlus1; i++ )
      {
        p = yi + (( widthMinus1 < i ? widthMinus1 : i ) << 2 );
        r_sum += ( stack.r = ( pr = pixels[p])) * ( rbs = radiusPlus1 - i );
        g_sum += ( stack.g = ( pg = pixels[p+1])) * rbs;
        b_sum += ( stack.b = ( pb = pixels[p+2])) * rbs;
        
        r_in_sum += pr;
        g_in_sum += pg;
        b_in_sum += pb;
        
        stack = stack.next;
      }
      
      
      stackIn = stackStart;
      stackOut = stackEnd;
      for ( x = 0; x < width; x++ )
      {
        pixels[yi]   = (r_sum * mul_sum) >> shg_sum;
        pixels[yi+1] = (g_sum * mul_sum) >> shg_sum;
        pixels[yi+2] = (b_sum * mul_sum) >> shg_sum;
        
        r_sum -= r_out_sum;
        g_sum -= g_out_sum;
        b_sum -= b_out_sum;
        
        r_out_sum -= stackIn.r;
        g_out_sum -= stackIn.g;
        b_out_sum -= stackIn.b;
        
        p =  ( yw + ( ( p = x + radius + 1 ) < widthMinus1 ? p : widthMinus1 ) ) << 2;
        
        r_in_sum += ( stackIn.r = pixels[p]);
        g_in_sum += ( stackIn.g = pixels[p+1]);
        b_in_sum += ( stackIn.b = pixels[p+2]);
        
        r_sum += r_in_sum;
        g_sum += g_in_sum;
        b_sum += b_in_sum;
        
        stackIn = stackIn.next;
        
        r_out_sum += ( pr = stackOut.r );
        g_out_sum += ( pg = stackOut.g );
        b_out_sum += ( pb = stackOut.b );
        
        r_in_sum -= pr;
        g_in_sum -= pg;
        b_in_sum -= pb;
        
        stackOut = stackOut.next;

        yi += 4;
      }
      yw += width;
    }

    for ( x = 0; x < width; x++ )
    {
      g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;
      
      yi = x << 2;
      r_out_sum = radiusPlus1 * ( pr = pixels[yi]);
      g_out_sum = radiusPlus1 * ( pg = pixels[yi+1]);
      b_out_sum = radiusPlus1 * ( pb = pixels[yi+2]);
      
      r_sum += sumFactor * pr;
      g_sum += sumFactor * pg;
      b_sum += sumFactor * pb;
      
      stack = stackStart;
      
      for( i = 0; i < radiusPlus1; i++ )
      {
        stack.r = pr;
        stack.g = pg;
        stack.b = pb;
        stack = stack.next;
      }
      
      yp = width;
      
      for( i = 1; i <= radius; i++ )
      {
        yi = ( yp + x ) << 2;
        
        r_sum += ( stack.r = ( pr = pixels[yi])) * ( rbs = radiusPlus1 - i );
        g_sum += ( stack.g = ( pg = pixels[yi+1])) * rbs;
        b_sum += ( stack.b = ( pb = pixels[yi+2])) * rbs;
        
        r_in_sum += pr;
        g_in_sum += pg;
        b_in_sum += pb;
        
        stack = stack.next;
      
        if( i < heightMinus1 )
        {
          yp += width;
        }
      }
      
      yi = x;
      stackIn = stackStart;
      stackOut = stackEnd;
      for ( y = 0; y < height; y++ )
      {
        p = yi << 2;
        pixels[p]   = (r_sum * mul_sum) >> shg_sum;
        pixels[p+1] = (g_sum * mul_sum) >> shg_sum;
        pixels[p+2] = (b_sum * mul_sum) >> shg_sum;
        
        r_sum -= r_out_sum;
        g_sum -= g_out_sum;
        b_sum -= b_out_sum;
        
        r_out_sum -= stackIn.r;
        g_out_sum -= stackIn.g;
        b_out_sum -= stackIn.b;
        
        p = ( x + (( ( p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1 ) * width )) << 2;
        
        r_sum += ( r_in_sum += ( stackIn.r = pixels[p]));
        g_sum += ( g_in_sum += ( stackIn.g = pixels[p+1]));
        b_sum += ( b_in_sum += ( stackIn.b = pixels[p+2]));
        
        stackIn = stackIn.next;
        
        r_out_sum += ( pr = stackOut.r );
        g_out_sum += ( pg = stackOut.g );
        b_out_sum += ( pb = stackOut.b );
        
        r_in_sum -= pr;
        g_in_sum -= pg;
        b_in_sum -= pb;
        
        stackOut = stackOut.next;
        
        yi += width;
      }
    }
    
    context.putImageData( imageData, top_x, top_y );
  },
  BlurStack: function() {
    this.r = 0;
    this.g = 0;
    this.b = 0;
    this.a = 0;
    this.next = null;
  }
}

var sp1 = new SpCom({
  el: '.sp1',
  gb: {
    w: 500,
    h: 400,
    x: 100,
    y: 100
  },
  imgList: imgList
})

</script>
</html>