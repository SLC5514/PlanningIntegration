<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>正片叠底</title>
        <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <style>
            .demo-list {
                padding: 20px;
            }

            .mode {
                display: inline-block;
                width: 1132px;
                height: 886px;
                position: relative;
                overflow: hidden;
            }

            img {
                display: block;
                width: 100%;
            }

            .positioning {
                width: 100%;
                height: 100%;
                position: absolute;
                top: 0;
                left: 0;
            }

            .mask1 {
                -webkit-mask: url(./mask1.png);
                -webkit-mask-size: cover;
            }

            .mask1>div {
                width: 100%;
                height: 100%;
                background: url(./bg1.jpg);
                background-size: 114px;
            }

            .mask2 {
                -webkit-mask: url(./mask2.png);
                -webkit-mask-size: cover;
            }

            .mask2>div {
                width: 100%;
                height: 100%;
                background: url(./bg2.jpg);
                background-size: 133px;
            }

            /* svg版 */
            svg {
                background: url(./bg.png) no-repeat;
            }

            .svg_mask {
                cursor: pointer;
                transition: all 0.5s ease;
            }

            .svg_mask:hover {
                opacity: 0.6;
            }

            use {
                mix-blend-mode: multiply;
            }
        </style>
    </head>

    <body>
        <div class="demo-list">
            <div>CSS3:</div>
            <div class="mode">
                <!-- 背景 -->
                <div class="positioning"><img src="./bg.png" /></div>
                <!-- 身子 -->
                <div class="positioning mask1" style="mix-blend-mode:multiply;">
                    <div></div>
                </div>
                <!-- 裙子 -->
                <div class="positioning mask2" style="mix-blend-mode:multiply;">
                    <div></div>
                </div>
            </div>
            <div>SVG:</div>
            <div class="mode">
                <!-- 背景 -->
                <svg width="1132" height="886">
                    <defs>
                        <!-- 身子 -->
                        <pattern id="svg_mask_bg1" width="114px" height="114px" x="0" y="0"
                            patternUnits="userSpaceOnUse">
                            <image width="114px" height="114px" xlink:href="./bg1.jpg" />
                        </pattern>
                        <!-- 裙子 -->
                        <pattern id="svg_mask_bg2" width="133px" height="133px" x="0" y="0"
                            patternUnits="userSpaceOnUse">
                            <image width="133px" height="133px" xlink:href="./bg2.jpg" />
                        </pattern>
                        <path
                            d="M461.72 205.16l-8.46 27.28 6.57 13.57-6.31 25.17-11.41 70.23.32 48.17 20.96 65.82.2 29.32 5.62 33.47 3.64 58.61 3.45 32.43 11.99 15.63L511 628.9l47.44-11.84 15.12-.1 88.55-.59 28.03-8.56 44.17-17.05 8.57-10.53-33.08-101.35-21.09-84.67-10-41.81-7.74-27.18-11.03-33.43-16.37-26.07-4.4-12.53 7.5-8.43-12.02-20.86-11.96-11.44-8.69-8.32-11.92-6.2-16.22-3.03-9.72.06-9.77-6.21-21.62-4.05-23.78-2.98-20.54-3-23.72 6.44-14.99 19.99z"
                            id="a" />
                        <path
                            d="M485.85 627.43l25.12 2.98 43.94-10.93h107.78l32.43-7.95 6.28 7.95 12.56 49.7-18.84 10.93h-21.97v12.93l-3.14 18.88-24.07 2.98H631.3l-21.98 4.98-54.41-7.96-28.25-8.94-15.69-9.94-12.56-2.99-7.32-9.94-5.24-10.93-11.51 6.96-5.23-10.94-15.69-19.88 3.14-21.87 17.78-6.95 11.51 10.93z"
                            id="b" />
                    </defs>
                    <use xlink:href="#a" class="svg_mask" data-id="1" fill="url(#svg_mask_bg1)" />
                    <use xlink:href="#b" class="svg_mask" data-id="2" fill="url(#svg_mask_bg2)" />
                </svg>
            </div>
        </div>
    </body>

    <script>
        // 拖动
        var downStatus = false;
        var hoverStatus = false;
        var tId = '';
        var tIdHover = '';
        var x = 0;
        var y = 0;
        var ogX = 0;
        var ogY = 0;
        $(document).on('mousedown', function (e) {
            var e = e || window.event;
            var target = $(e.target);
            if (!downStatus && e.button === 0 && target.hasClass('svg_mask')) {
                tId = target.data('id');
                downStatus = true;
                x = e.pageX;
                y = e.pageY;
                ogX = parseInt($('#svg_mask_bg' + tId).attr('x'));
                ogY = parseInt($('#svg_mask_bg' + tId).attr('y'));
            }
        }).on('mousemove', function (e) {
            var e = e || window.event;
            var target = $(e.target);
            if (downStatus && tId) {
                $('#svg_mask_bg' + tId).attr({
                    'x': ogX + (e.pageX - x),
                    'y': ogY + (e.pageY - y)
                });
            }
            if (target.hasClass('svg_mask')) {
                tIdHover = target.data('id');
                hoverStatus = true;
            } else {
                hoverStatus = false;
            }
        }).on('mouseup', function () {
            downStatus = false;
            tId = '';
        })

        // 缩放
        var eventHandle = {
            getEvent: function (event) {
                return event || window.event;
            },
            addEvent: function (elementName, type, handler) {
                document.querySelectorAll(elementName).forEach(function (element) {
                    if (element.addEventListener) {
                        element.addEventListener(type, handler, false);
                    }
                    else if (element.attachEvent) {
                        element.attachEvent('on' + type, handler);
                    } else {
                        element['on' + type] = handler;
                    }
                })
            },
            getWheelDelta: function (event) {
                return event.wheelDelta ? event.wheelDelta : (-event.detail) * 40;
            }
        }

        function mouseHandle(event) {
            if (hoverStatus) {
                var e = event || window.event;
                event.preventDefault();
                event = eventHandle.getEvent(event);
                var target = $(event.target);
                var delta = eventHandle.getWheelDelta(event);
                var maskEl = $('#svg_mask_bg' + tIdHover);
                if (delta < 0) {delta = -4;}
                else {delta = 4;}
                var ogW = parseInt(maskEl.attr('width'));
                var ogH = parseInt(maskEl.attr('height'));
                var w = ogW + delta;
                var h = ogH + delta;
                if (w <= 0) {w = 4;}
                if (h <= 0) {h = 4;}
                maskEl.attr({
                    'width': w,
                    'height': h,
                    'x': parseInt(maskEl.attr('x')) + (ogW - w)*5,
                    'y': parseInt(maskEl.attr('y')) + (ogH - h)*5
                }).find('image').attr({
                    'width': w,
                    'height': h
                });
            }
        }

        eventHandle.addEvent('.svg_mask', 'mousewheel', mouseHandle);
        eventHandle.addEvent('.svg_mask', 'DOMMouseScroll', mouseHandle);
    </script>

</html>